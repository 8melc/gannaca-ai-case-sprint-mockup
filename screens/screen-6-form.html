<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Case-Erfassung | gannaca AI Case Sprint</title>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../styles/variables.css">
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/forms.css">
  
  <!-- Google Fonts (Inter) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Storage Script -->
  <script src="../js/storage.js"></script>
  
  <!-- Toast Notification System -->
  <script src="../js/toast.js"></script>
  
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <!-- Fokus-Modus Styles -->
  <style>
    /* FOKUS-MODUS BUTTON */
    .btn-focus-mode {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--off-white);
      border: 2px solid var(--navy);
      border-radius: 8px;
      color: var(--navy);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-focus-mode:hover {
      background: var(--navy);
      color: white;
    }
    .btn-focus-mode.active {
      background: var(--navy);
      color: white;
    }
    .btn-focus-mode i[data-lucide] {
      width: 16px;
      height: 16px;
    }

    /* PAGE HEADER STICKY (Normal-Modus) */
    .page-header-sticky {
      position: sticky;
      top: calc(var(--header-height) + var(--nav-height));
      z-index: 80;
      background: var(--white);
      padding-top: var(--space-6);
      padding-bottom: var(--space-4);
      border-bottom: 1px solid var(--border-gray);
    }

    /* Scroll-Offset für Sections (Normal-Modus) */
    .form-section {
      scroll-margin-top: 150px;
    }

    /* ============================================
       FOKUS-MODUS NAVIGATION - KOMPAKT
       ============================================ */
    .focus-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 2px solid var(--navy);
      padding: 10px 20px;   /* KOMPAKT */
      z-index: 1000;
      box-shadow: 0 -2px 12px rgba(0,0,0,0.06);
    }
    .focus-nav-inner {
      max-width: 100%;
      margin: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
    }

    /* PROGRESS SECTION - LINKS */
    .focus-nav-progress {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 16px;
      flex: 1;
    }

    /* FRAGE X VON 11 - KOMPAKT */
    .focus-nav-step {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-medium);
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .focus-nav-step-number {
      font-size: 20px;
      font-weight: 700;
      color: var(--navy);
      display: inline;
      line-height: 1;
    }

    /* FRAGEN-TITEL ANZEIGE - KOMPAKT */
    .focus-nav-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-dark);
      margin: 0;
      max-width: 300px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* DOTS MIT TOOLTIPS - KOMPAKT */
    .focus-nav-dots {
      display: flex;
      gap: 6px;
      margin: 0;
    }
    .focus-nav-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--light-gray);
      border: 2px solid var(--border-gray);
      transition: all 0.2s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      color: var(--text-light);
      position: relative;
    }
    .focus-nav-dot:hover {
      border-color: var(--navy);
      background: var(--off-white);
      transform: scale(1.1);
    }
    .focus-nav-dot.active {
      background: var(--navy);
      border-color: var(--navy);
      color: white;
      transform: scale(1.15);
      box-shadow: 0 2px 8px rgba(26, 58, 92, 0.3);
    }
    .focus-nav-dot.completed {
      background: #E8F5E9;
      border-color: #4CAF50;
      color: #2E7D32;
    }
    .focus-nav-dot.has-data {
      background: #FFF8E1;
      border-color: #FFC107;
      color: #F57C00;
    }
    .focus-nav-dot.has-data.completed {
      background: #E8F5E9;
      border-color: #4CAF50;
      color: #2E7D32;
    }

    /* TOOLTIP FÜR DOTS */
    .focus-nav-dot::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--navy);
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 500;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      pointer-events: none;
      margin-bottom: 8px;
      z-index: 100;
    }
    .focus-nav-dot:hover::after {
      opacity: 1;
      visibility: visible;
    }

    /* BUTTONS - RECHTS - KOMPAKT */
    .focus-nav-buttons {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .focus-nav-btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s ease;
      min-width: 100px;
      justify-content: center;
    }
    .focus-nav-btn-prev {
      background: white;
      border: 2px solid var(--navy);
      color: var(--navy);
    }
    .focus-nav-btn-prev:hover:not(:disabled) {
      background: var(--off-white);
    }
    .focus-nav-btn-prev:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    .focus-nav-btn-next {
      background: var(--navy);
      border: 2px solid var(--navy);
      color: white;
    }
    .focus-nav-btn-next:hover {
      background: #0d2840;
      box-shadow: 0 4px 12px rgba(26, 58, 92, 0.3);
    }
    .focus-nav-btn-save {
      background: #2E7D32;
      border: 2px solid #2E7D32;
      color: white;
    }
    .focus-nav-btn-save:hover {
      background: #1B5E20;
    }
    .focus-nav-btn i[data-lucide] {
      width: 18px;
      height: 18px;
    }

    /* AUTO-SAVE INDIKATOR - KOMPAKT */
    .autosave-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: var(--text-light);
      padding: 4px 10px;
      background: var(--off-white);
      border-radius: 16px;
    }
    .autosave-indicator.saving {
      color: var(--orange);
    }
    .autosave-indicator.saved {
      color: #2E7D32;
    }
    .autosave-indicator i {
      width: 14px;
      height: 14px;
    }

    /* ============================================
       FOKUS-MODUS AKTIV - KOMPAKT & KLAR
       ============================================ */
    body.focus-mode-active .form-section {
      display: none !important;
    }
    body.focus-mode-active .form-section.focus-visible {
      display: flex !important;
      flex-direction: column;
      animation: fadeInUp 0.25s ease-out;
      /* KOMPAKT: Weniger Padding, mehr Inhalt */
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
      padding: 20px 28px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 16px rgba(0,0,0,0.04);
      border: 1px solid var(--border-gray);
      /* Flex füllt verfügbaren Platz */
      flex: 1;
      min-height: 0;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* STICKY: Frage-Titel bleibt immer sichtbar */
    body.focus-mode-active .form-section-title {
      position: sticky;
      top: 0;
      background: white;
      padding: 12px 0 16px 0;
      margin: 0 0 12px 0;
      border-bottom: 2px solid var(--border-gray);
      z-index: 10;
      flex-shrink: 0;
    }

    /* SCROLL: Form-Group scrollbar machen */
    body.focus-mode-active .form-group {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      margin-bottom: 0;
      padding-bottom: 16px;
      border-bottom: none;
    }

    /* Scrollbar-Styling */
    body.focus-mode-active .form-group::-webkit-scrollbar {
      width: 6px;
    }
    body.focus-mode-active .form-group::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    body.focus-mode-active .form-group::-webkit-scrollbar-thumb {
      background: #ccc;
      border-radius: 3px;
    }
    body.focus-mode-active .form-group::-webkit-scrollbar-thumb:hover {
      background: #aaa;
    }

    /* BEAMER-OPTIMIERT: Fokus-Section für große Displays */
    @media screen and (min-width: 1920px) {
      body.focus-mode-active .form-section.focus-visible {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px 40px;
      }

      body.focus-mode-active .form-section-title {
        font-size: 24px;
        padding: 16px 0 20px 0;
        margin-bottom: 16px;
        font-weight: 700;
        line-height: 1.3;
      }

      body.focus-mode-active .form-section-number {
        width: 60px;
        height: 60px;
        font-size: 26px;
        font-weight: 700;
      }

      /* Labels – größer und deutlicher */
      body.focus-mode-active .form-label {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
        line-height: 1.4;
      }

      body.focus-mode-active .form-hint {
        font-size: 15px;
      }

      /* Input-Felder – große Schrift für bessere Lesbarkeit */
      body.focus-mode-active .form-input,
      body.focus-mode-active .form-textarea,
      body.focus-mode-active .form-select {
        font-size: 18px;
        padding: 18px 24px;
        line-height: 1.5;
      }

      body.focus-mode-active .form-input::placeholder,
      body.focus-mode-active .form-textarea::placeholder {
        font-size: 18px;
      }

      /* Radio & Checkbox – größer */
      body.focus-mode-active .form-radio-item,
      body.focus-mode-active .form-checkbox-item {
        padding: 18px 28px;
        font-size: 17px;
      }

      body.focus-mode-active .form-radio-item input,
      body.focus-mode-active .form-checkbox-item input {
        width: 22px;
        height: 22px;
      }

      /* Fokus-Navigation – Beamer-optimiert aber kompakt */
      .focus-nav {
        padding: 14px 40px;
      }

      .focus-nav-step {
        font-size: 12px;
      }

      .focus-nav-step-number {
        font-size: 24px;
        font-weight: 700;
      }

      .focus-nav-title {
        font-size: 16px;
        font-weight: 500;
      }

      .focus-nav-dot {
        width: 28px;
        height: 28px;
        font-size: 11px;
        font-weight: 700;
      }

      .focus-nav-btn {
        padding: 12px 24px;
        font-size: 14px;
        font-weight: 600;
      }

      .focus-nav-btn i {
        width: 18px;
        height: 18px;
      }

      .autosave-indicator {
        font-size: 12px;
      }

      /* Rating-Items */
      body.focus-mode-active .form-rating-item {
        width: 60px;
        height: 60px;
        font-size: 28px;
      }

      /* Bestätigungsdialog */
      .confirm-dialog {
        max-width: 520px;
      }

      .confirm-dialog-header h3 {
        font-size: 22px;
      }

      .confirm-dialog-body {
        padding: 24px 32px;
        font-size: 16px;
      }

      .confirm-dialog-stat {
        font-size: 15px;
        padding: 10px 0;
      }

      .confirm-dialog-footer {
        padding: 20px 32px;
        gap: 12px;
      }

      .confirm-dialog-footer button {
        padding: 14px 32px;
        font-size: 16px;
      }
    }

    body.focus-mode-active .focus-nav {
      display: block;
    }
    body.focus-mode-active .form-actions,
    body.focus-mode-active .form-disclaimer,
    body.focus-mode-active .form-progress,
    body.focus-mode-active .form-header,
    body.focus-mode-active .form-required-hint,
    body.focus-mode-active .page-header-sticky {
      display: none !important;
    }
    body.focus-mode-active .main-content {
      /* KORREKT: Padding-top muss Header + Nav berücksichtigen */
      padding-top: calc(var(--header-height) + var(--nav-height) + 12px);
      padding-left: 16px;
      padding-right: 16px;
      padding-bottom: calc(var(--focus-nav-height) + 12px);
      background: var(--off-white);
      min-height: 100vh;
      height: 100vh;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      overflow: hidden;
    }
    body.focus-mode-active .form-container {
      background: transparent;
      box-shadow: none;
      max-width: 100%;
      padding: 0;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow: hidden;
    }
    body.focus-mode-active .page-header {
      display: none;
    }

    /* Schritt-Nummer größer im Fokus */
    body.focus-mode-active .form-section-number {
      width: 52px;
      height: 52px;
      font-size: 22px;
    }
    body.focus-mode-active .form-section-title {
      font-size: 24px;
      margin-bottom: 28px;
      padding-bottom: 20px;
    }
    body.focus-mode-active .form-input,
    body.focus-mode-active .form-textarea,
    body.focus-mode-active .form-select {
      font-size: 17px;
      padding: 16px 18px;
    }
    body.focus-mode-active .form-radio-item,
    body.focus-mode-active .form-checkbox-item {
      padding: 14px 20px;
      font-size: 15px;
    }

    /* Pflichtfeld-Indikator im Fokus-Modus */
    body.focus-mode-active .form-label-required::after {
      font-size: 1.3em;
    }

    /* ============================================
       ZWEISPALTEN-LAYOUT FÜR KOMPAKTE DARSTELLUNG
       Reduziert Scroll-Höhe bei vielen Optionen
       ============================================ */

    /* Frage 2: Abteilungen - 12 Checkboxen → 2 Spalten */
    body.focus-mode-active #abteilungen.form-checkbox-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    /* Frage 5: Häufigkeit - 7 Radio-Buttons → 2 Spalten */
    body.focus-mode-active #haeufigkeit.form-radio-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    /* Frage 10: Daten-Verfügbarkeit - 4 Radio-Buttons → 2 Spalten */
    body.focus-mode-active #datenVerfuegbarkeit.form-radio-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    /* Kompaktere Radio/Checkbox Items im Fokus-Modus */
    body.focus-mode-active .form-radio-item,
    body.focus-mode-active .form-checkbox-item {
      padding: 12px 16px;
      min-height: auto;
    }

    /* Kompaktere Textareas im Fokus-Modus */
    body.focus-mode-active .form-textarea {
      min-height: 100px;
    }

    /* Kompaktere Form-Groups im Fokus-Modus */
    body.focus-mode-active .form-group {
      margin-bottom: var(--space-6);
      padding-bottom: var(--space-6);
    }

    /* Kompaktere Section-Titel */
    body.focus-mode-active .form-section-title {
      margin-bottom: 20px;
      padding-bottom: 16px;
    }

    /* Frage 6: Grid kompakter */
    body.focus-mode-active .grid-4 {
      gap: 16px;
    }

    /* ============================================
       FIX: Labels ohne Zeilenumbruch bei Frage 6
       ============================================ */

    /* Frage 6: Labels in einer Zeile halten */
    body.focus-mode-active .grid-4 .form-label {
      white-space: nowrap;
      font-size: 13px;
      line-height: 1.3;
    }

    /* Frage 6: Grid breiter machen */
    body.focus-mode-active .grid-4 {
      grid-template-columns: repeat(4, minmax(150px, 1fr));
      gap: 20px;
    }

    /* Frage 7: Strategische Relevanz - horizontal/inline */
    body.focus-mode-active #relevanz.form-radio-group {
      display: flex;
      flex-direction: row;
      gap: 12px;
    }
    body.focus-mode-active #relevanz .form-radio-item {
      flex: 1;
      justify-content: center;
      text-align: center;
    }

    /* Frage 8: Rating bereits horizontal - kompakter */
    body.focus-mode-active .form-rating-group {
      gap: 8px;
    }
    body.focus-mode-active .form-rating-item {
      width: 52px;
      height: 52px;
    }

    /* BEAMER-MODUS: Spezifische Grid-Anpassungen für große Displays */
    @media screen and (min-width: 1920px) {
      /* Mehrspaltige Checkbox/Radio-Gruppen – optimales Layout für Beamer */
      body.focus-mode-active #abteilungen.form-checkbox-group,
      body.focus-mode-active #haeufigkeit.form-radio-group,
      body.focus-mode-active #datenVerfuegbarkeit.form-radio-group {
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      /* Höhere Kontrastabilität für Checkbox/Radio-Items */
      body.focus-mode-active .form-radio-item,
      body.focus-mode-active .form-checkbox-item {
        padding: 16px 24px;
        font-size: 16px;
        border-radius: 10px;
        transition: all 0.2s ease;
      }

      body.focus-mode-active .form-radio-item:hover,
      body.focus-mode-active .form-checkbox-item:hover {
        background: rgba(26, 58, 92, 0.04);
      }

      /* Rating-Items größer */
      body.focus-mode-active .form-rating-item {
        width: 64px;
        height: 64px;
        font-size: 32px;
        font-weight: 700;
      }

      body.focus-mode-active .form-rating-item:hover {
        transform: scale(1.08);
      }

      /* Form-Groups Spacing */
      body.focus-mode-active .form-group {
        margin-bottom: 28px;
      }

      /* Hinweis-Text – lesbarer */
      body.focus-mode-active .regel-hinweis {
        padding: 20px 24px;
        margin-bottom: 28px;
        border-left-width: 5px;
      }

      body.focus-mode-active .regel-hinweis-title {
        font-size: 16px;
      }

      body.focus-mode-active .regel-hinweis-text {
        font-size: 15px;
      }

      /* FIX: Frage 6 - Labels in einer Zeile auf großen Displays */
      body.focus-mode-active .grid-4 {
        grid-template-columns: repeat(4, minmax(180px, 1fr));
        gap: 28px;
      }

      body.focus-mode-active .grid-4 .form-label {
        white-space: nowrap;
        font-size: 14px;
        margin-bottom: 12px;
        line-height: 1.3;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ============================================
       BESTÄTIGUNGSDIALOG
       ============================================ */
    .confirm-dialog-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .confirm-dialog {
      background: white;
      border-radius: 16px;
      max-width: 480px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: dialogFadeIn 0.2s ease-out;
    }
    @keyframes dialogFadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    .confirm-dialog-header {
      padding: 24px 28px 16px;
      border-bottom: 1px solid var(--border-gray);
    }
    .confirm-dialog-header h3 {
      margin: 0;
      font-size: 20px;
      color: var(--text-darkest);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .confirm-dialog-body {
      padding: 20px 28px;
    }
    .confirm-dialog-summary {
      background: var(--off-white);
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .confirm-dialog-summary h4 {
      margin: 0 0 12px 0;
      font-size: 13px;
      color: var(--text-medium);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .confirm-dialog-stat {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-gray);
      font-size: 14px;
    }
    .confirm-dialog-stat:last-child {
      border-bottom: none;
    }
    .confirm-dialog-stat-label {
      color: var(--text-medium);
    }
    .confirm-dialog-stat-value {
      font-weight: 600;
      color: var(--text-darkest);
    }
    .confirm-dialog-stat-value.warning {
      color: var(--orange);
    }
    .confirm-dialog-stat-value.success {
      color: #2E7D32;
    }
    .confirm-dialog-footer {
      padding: 16px 28px 24px;
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
    .confirm-dialog-btn {
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .confirm-dialog-btn-cancel {
      background: white;
      border: 2px solid var(--border-gray);
      color: var(--text-medium);
    }
    .confirm-dialog-btn-cancel:hover {
      border-color: var(--text-medium);
    }
    .confirm-dialog-btn-confirm {
      background: var(--navy);
      border: 2px solid var(--navy);
      color: white;
    }
    .confirm-dialog-btn-confirm:hover {
      background: #0d2840;
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    
    <!-- NEUER HEADER -->
    <header class="main-header">
      <div class="header-container">
        <div class="header-left">
          <div class="logo-group">
            <img src="../assets/gannaca-logo.png" alt="gannaca" class="gannaca-logo">
            <div class="title-group">
              <h1 class="main-title">AI Case Sprint</h1>
              <p class="subtitle">Standardisiertes Framework für KI-Use-Case-Entwicklung</p>
            </div>
          </div>
        </div>
        <div class="header-right">
          <img src="../assets/trianel-logo.png" alt="Trianel" class="client-logo">
          <div class="header-info">
            <span class="version-badge">04.02.2026</span>
          </div>
        </div>
      </div>
    </header>
    
    <div class="terminology-mandatory">
      DATENSCHUTZ-KONFORM – KEINE PRODUKTIVDATEN<br>
      Dieses Mockup dient ausschließlich zur Visualisierung.<br>
      Alle gezeigten Beispiele sind fiktiv. Keine Erfassung,<br>
      Verarbeitung oder Speicherung von produktiven Trianel-Daten.
    </div>
    <!-- TERMINOLOGIE-COMPLIANT -->
    
    <!-- NAVIGATION -->
    <nav class="nav-tabs">
      <div class="nav-tabs-inner">
        <a href="screen-0-workshop-process.html" class="nav-tab"><span class="nav-tab-number">0</span> Workshop-Prozess</a>
        <a href="screen-1-overview.html" class="nav-tab"><span class="nav-tab-number">1</span> Übersicht</a>
        <a href="screen-2-kpi.html" class="nav-tab nav-tab-optional"><span class="nav-tab-number">2</span> KPI-Rahmen</a>
        <a href="screen-3-governance.html" class="nav-tab"><span class="nav-tab-number">3</span> Governance</a>
        <a href="screen-4-case-beispiel.html" class="nav-tab"><span class="nav-tab-number">4</span> Case-Beispiel</a>
        <a href="screen-5-tool-mockup.html" class="nav-tab"><span class="nav-tab-number">5</span> Mockup-Beispiel</a>
        <a href="screen-6-form.html" class="nav-tab active"><span class="nav-tab-number">6</span> Case-Erfassung <i data-lucide="star" class="icon-sm"></i></a>
        <a href="screen-7-results.html" class="nav-tab"><span class="nav-tab-number">7</span> Ergebnis</a>
      </div>
    </nav>
    
    <!-- MAIN CONTENT -->
    <main class="main-content">
      
      <!-- Page Header -->
      <div class="page-header page-header-sticky">
        <div class="page-header-inner">
          <h1 class="page-title"><i data-lucide="clipboard-edit" class="icon-with-text"></i>Case-Erfassung</h1>
          <p class="page-subtitle">11 Standardfragen pro Case</p>
        </div>
      </div>
      
      <div class="container">
        
        
        <!-- Form Container -->
        <div class="form-container">
          
          <!-- FESTLEGUNG (nur sichtbar wenn NICHT im Fokus-Modus) -->
          <div class="form-disclaimer" style="padding: 12px 16px; margin-bottom: 16px; border-left: none; background: var(--off-white); border: 1px solid var(--border-gray); border-radius: var(--border-radius-md);">
            <div class="form-disclaimer-content" style="display: block;">
              <p style="font-size: 12px; color: var(--text-medium); margin: 0; line-height: 1.5;">
                Erfassung nach 11 Standardfragen. Keine Bewertung – Priorisierung erfolgt in Phase 2.
              </p>
            </div>
          </div>

          <!-- Pflichtfeld-Hinweis -->
          <div class="form-required-hint">
            <span>*</span> Pflichtfelder sind mit einem Sternchen gekennzeichnet
          </div>
          
          <!-- Form Header / Meta Info -->
          <div class="form-header">
            <div class="form-header-row">
              <div class="form-meta">
                <div class="form-meta-item">
                  <span class="form-meta-label">Case-Nummer:</span>
                  <strong style="color: var(--color-accent);" id="caseNumber">#01</strong>
                </div>
                <div class="form-meta-item">
                  <span class="form-meta-label">Erfasst von:</span>
                  <span>Melissa Conrads</span>
                </div>
                <div class="form-meta-item">
                  <span class="form-meta-label">Zeitstempel:</span>
                  <span id="currentTime">--:-- Uhr</span>
                </div>
              </div>
              <div class="form-meta" style="display: flex; align-items: center; gap: var(--spacing-lg);">
                <!-- FOKUS-MODUS TOGGLE -->
                <button type="button" class="btn btn-focus-mode" id="focusModeToggle" onclick="toggleFocusMode()" title="Fokus-Modus für Beamer-Präsentation">
                  <i data-lucide="maximize-2" id="focusModeIcon"></i>
                  <span id="focusModeLabel">Fokus</span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- FORMULAR -->
          <form id="caseForm">
            
            <!-- FELD 1: Beschreibung der Ausgangslage -->
            <!-- Hinweis für Moderatorin (nicht sichtbar im UI): Nicht für Plenum sichtbar -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">1</span>
                Beschreibung der Ausgangslage
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Beschreibt in einem Satz, worum es geht.</label>
                <input type="text" class="form-input" id="ausgangslage" placeholder="z.B. Anzahl der Vertragsänderungen steigt, Bearbeitungszeit pro Fall erhöht sich" maxlength="120" required>
              </div>
            </div>
            
            <!-- FELD 2: Betroffene Abteilung(en) -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">2</span>
                Betroffene Abteilung(en)
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Welche Abteilungen sind beteiligt oder betroffen?</label>
                <div class="form-checkbox-group" id="abteilungen">
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Legal & Insurance"><span class="form-checkbox-label">Legal & Insurance</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Compliance"><span class="form-checkbox-label">Compliance</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Revision"><span class="form-checkbox-label">Revision</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="IT & Consulting"><span class="form-checkbox-label">IT & Consulting</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Human Resources"><span class="form-checkbox-label">Human Resources</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Finance"><span class="form-checkbox-label">Finance</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Procurement"><span class="form-checkbox-label">Procurement</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Risk Management"><span class="form-checkbox-label">Risk Management</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Portfolio Management"><span class="form-checkbox-label">Portfolio Management</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Sales & Vertrieb"><span class="form-checkbox-label">Sales & Vertrieb</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Market Analysis"><span class="form-checkbox-label">Market Analysis</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Weitere" id="abteilungWeitereCheckbox" onchange="toggleWeitereAbteilung()"><span class="form-checkbox-label">Weitere Abteilung:</span></label>
                </div>
                <div id="weitereAbteilungContainer" style="display: none; margin-top: var(--spacing-md);">
                  <input type="text" class="form-input" id="abteilungWeitere" placeholder="z.B. Projektentwicklung, Trading Floor">
                </div>
              </div>
            </div>
            
            <!-- FELD 3: Was ist die Lage? -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">3</span>
                Was ist die Lage?
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Was passiert aktuell? Beschreibt die Situation sachlich.</label>
                <textarea class="form-textarea" id="lage" rows="4" placeholder="z.B. Fallzahlen steigen seit 2023, Bearbeitungszeit pro Fall hat sich verdoppelt, Team arbeitet regelmäßig über" required></textarea>
              </div>
            </div>
            
            <!-- FELD 4: Prozessablauf -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">4</span>
                Prozessablauf
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Beschreibt die einzelnen Schritte in der Reihenfolge, wie sie aktuell ablaufen.</label>
                <textarea class="form-textarea" id="prozessablauf" rows="3" placeholder="Schritt 1: Vertragsentwurf kommt rein → Schritt 2: Prüfung Rechtslage → Schritt 3: Freigabe durch Senior → Schritt 4: ..." required></textarea>
              </div>
            </div>
            
            <!-- FELD 5: Häufigkeit -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">5</span>
                Häufigkeit
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Wie oft kommt dieser Fall vor?</label>
                <div class="form-radio-group" id="haeufigkeit">
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Täglich"><span class="form-radio-label">Täglich</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Wöchentlich"><span class="form-radio-label">Wöchentlich</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Monatlich"><span class="form-radio-label">Monatlich</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Quartalsweise"><span class="form-radio-label">Quartalsweise</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Jährlich"><span class="form-radio-label">Jährlich</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Unregelmäßig"><span class="form-radio-label">Unregelmäßig</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Unbestimmt"><span class="form-radio-label">Unbestimmt</span></label>
                </div>
                <div class="form-inline-group" style="margin-top: var(--spacing-lg);">
                  <span class="form-inline-label">Anzahl Vorgänge pro Zeiteinheit:</span>
                  <input type="number" class="form-input form-input-small" id="anzahlVorgaenge" placeholder="z.B. 50 (optional, falls bekannt)" min="1">
                </div>
              </div>
            </div>
            
            <!-- FELD 6: Betroffene Personen & Zeitaufwand -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">6</span>
                Betroffene Personen & Zeitaufwand
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required" style="margin-bottom: var(--space-4);">Wie viele Personen sind beteiligt und wie viel Zeit wird pro Fall benötigt?</label>
                <div class="grid grid-4">
                  <div>
                    <label class="form-label form-label-required">Anzahl betroffener Mitarbeiter</label>
                    <input type="number" class="form-input" id="betroffenePersonen" placeholder="z.B. 3" min="1">
                  </div>
                  <div>
                    <label class="form-label form-label-required">Qualifizierungsgrad</label>
                    <select class="form-select" id="qualifizierungsgrad">
                      <option value="">Bitte wählen...</option>
                      <option value="Junior">Junior</option>
                      <option value="Medior">Medior</option>
                      <option value="Senior">Senior</option>
                      <option value="Spezialist">Spezialist</option>
                      <option value="Fachanwalt">Fachanwalt</option>
                    </select>
                  </div>
                  <div>
                    <label class="form-label form-label-required">Zeitaufwand pro Fall</label>
                    <div class="form-inline-group">
                      <input type="number" class="form-input" id="zeitaufwandWert" placeholder="z.B. 25" min="1" style="width: 100px;">
                      <select class="form-select" id="zeitaufwandEinheit" style="width: auto;">
                        <option value="minutes">Minuten</option>
                        <option value="hours">Stunden</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label class="form-label">Gesamtaufwand/Jahr (geschätzt)</label>
                    <input type="text" class="form-input" id="gesamtaufwand" placeholder="Wird berechnet..." readonly style="background: var(--color-bg-light); font-weight: 700; transition: background-color 0.3s ease;">
                    <span class="form-hint" id="gesamtaufwandHint" style="display: none; color: #28a745; margin-top: 4px;"><i data-lucide="check" class="icon-sm icon-success"></i> Automatisch berechnet</span>
                    <span class="form-hint" id="gesamtaufwandFormel" style="margin-top: 4px; font-size: 11px; color: var(--text-light);"><i data-lucide="calculator" class="icon-sm"></i> = Vorgänge × Häufigkeit × Zeit × Personen</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- FELD 7: Strategische Relevanz -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">7</span>
                Strategische Relevanz
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Erste Einschätzung durch euch – wie wichtig ist das Thema?</label>
                <div class="form-radio-group" id="relevanz">
                  <label class="form-radio-item" style="flex: 1; justify-content: center;"><input type="radio" class="form-radio" name="relevanz" value="Hoch"><span class="form-radio-label">■ Hoch</span></label>
                  <label class="form-radio-item" style="flex: 1; justify-content: center;"><input type="radio" class="form-radio" name="relevanz" value="Mittel"><span class="form-radio-label">▪ Mittel</span></label>
                  <label class="form-radio-item" style="flex: 1; justify-content: center;"><input type="radio" class="form-radio" name="relevanz" value="Niedrig"><span class="form-radio-label">○ Niedrig</span></label>
                </div>
              </div>
            </div>
            
            <!-- FELD 8: Risiko bei Nicht-Handlung -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">8</span>
                Risiko bei Nicht-Handlung
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Was passiert, wenn sich nichts ändert?</label>
                <div class="form-rating-group" id="risikoGroup">
                  <label class="form-rating-item"><input type="radio" name="risiko" value="1">1</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="2">2</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="3">3</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="4">4</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="5">5</label>
                </div>
                <span class="form-hint" style="margin-top: var(--spacing-sm);">1 = unkritisch | 5 = sehr kritisch</span>
                <div style="margin-top: var(--spacing-lg);">
                  <label class="form-label">Kurze Begründung (optional)</label>
                  <textarea 
                    class="form-textarea" 
                    id="risikoBegruendung" 
                    rows="3"
                    placeholder="z.B.: Betriebsprüfung: Fehler nicht nachzuvollziehen. Compliance-Risiko. Reputationsschaden. Audit-Findings. Bußgelder..."
                  ></textarea>
                </div>
              </div>
            </div>
            
            <!-- FELD 9: Vorhandene Lösungsansätze -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">9</span>
                Vorhandene Lösungsansätze
              </h3>
              <div class="form-group">
                <label class="form-label">Gibt es bereits etwas, das teilweise hilft oder den Ablauf erleichtert?</label>
                <div class="form-radio-group">
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="vorhandeneLoesung" value="yes"><span class="form-radio-label">Ja</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="vorhandeneLoesung" value="no"><span class="form-radio-label">Nein</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="vorhandeneLoesung" value="unclear"><span class="form-radio-label">Unklar</span></label>
                </div>
                <div style="margin-top: var(--spacing-lg);">
                  <label class="form-label">Falls ja, bitte beschreiben:</label>
                  <input type="text" class="form-input" id="vorhandeneLösungBeschreibung" placeholder="z.B. Excel-Makro, SharePoint-Workflow, Jurion-Abfrage...">
                </div>
              </div>
            </div>
            
            <!-- FELD 10: Daten-Verfügbarkeit -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">10</span>
                Daten-Verfügbarkeit
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Liegen die relevanten Daten digital vor?</label>
                <div class="form-radio-group" id="datenVerfuegbarkeit">
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="full_digital"><span class="form-radio-label"><i data-lucide="check-circle" class="icon-sm icon-success"></i> Ja, vollständig digital</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="partial"><span class="form-radio-label"><i data-lucide="alert-triangle" class="icon-sm icon-warning"></i> Teilweise digital</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="paper"><span class="form-radio-label"><i data-lucide="file-text" class="icon-sm icon-muted"></i> Überwiegend Papier</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="unclear"><span class="form-radio-label">❓ Unklar</span></label>
                </div>
                <div style="margin-top: var(--spacing-lg);">
                  <label class="form-label">Welche Daten konkret? (optional)</label>
                  <input type="text" class="form-input" id="datenDetails" placeholder="z.B. Verträge in DMS, E-Mails, Gutachten, Aktennotizen...">
                </div>
              </div>
            </div>
            
            <!-- FELD 11: Welche Art von Unterstützung wäre hilfreich? (Optional) -->
            <div class="form-section" style="background: var(--color-bg-light);">
              <h3 class="form-section-title">
                <span class="form-section-number">11</span>
                Welche Art von Unterstützung wäre hilfreich?
              </h3>
              <div class="form-group">
                <label class="form-label">Beschreibt, was den Ablauf erleichtern würde – ganz ohne technische Vorkenntnisse.</label>
                <textarea 
                  class="form-textarea" 
                  id="vorstellung" 
                  rows="5"
                  placeholder="z.B.:
• Automatische Vollständigkeitsprüfung
• Abgleich mit Richtlinien
• Abweichungen markieren
• Textanalyse
• Kategorisierung

Das Feld wächst automatisch beim Tippen!"
                  style="background: var(--color-bg-white); min-height: 150px;"
                ></textarea>
                <span class="form-hint"><i data-lucide="info" class="icon-sm icon-info"></i> Optional. Keine Bewertung erforderlich. Dient nur der späteren Analyse.</span>
              </div>
            </div>

            <!-- ============================================
                 GOVERNANCE & LEGAL TRIGGER BLOCK (PFLICHT)
                 Diese Felder lösen die Prüfinstanz-Logik aus
                 ============================================ -->
            <div class="form-section" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border: 2px solid var(--navy); border-radius: var(--border-radius-lg);">
              <h3 class="form-section-title" style="color: var(--navy);">
                <span class="form-section-number" style="background: var(--navy); color: white;">G</span>
                Governance & Legal Trigger
              </h3>

              <!-- INFO-HINWEIS -->
              <div style="background: rgba(26, 58, 92, 0.08); padding: 12px 16px; border-radius: 8px; margin-bottom: 24px; display: flex; align-items: flex-start; gap: 10px;">
                <i data-lucide="alert-circle" style="width: 18px; height: 18px; color: var(--navy); flex-shrink: 0; margin-top: 2px;"></i>
                <span style="font-size: 13px; color: var(--text-dark); line-height: 1.5;">
                  <strong>Hinweis:</strong> Diese Angaben bestimmen, ob eine formale Prüfinstanz erforderlich ist.<br>
                  <em style="color: var(--text-medium);">Regel: Wenn ein Trigger = „Ja" oder „Unklar" → Prüfinstanz erforderlich.</em>
                </span>
              </div>

              <!-- TRIGGER 1: Entscheidungswirkung -->
              <div class="form-group">
                <label class="form-label form-label-required">
                  <i data-lucide="scale" class="icon-sm icon-with-text" style="color: var(--navy);"></i>
                  Hat die KI-Anwendung Entscheidungswirkung?
                </label>
                <span class="form-hint" style="margin-bottom: 12px; display: block;">Beeinflusst das Ergebnis eine rechtlich oder wirtschaftlich relevante Entscheidung?</span>
                <div class="form-radio-group" id="entscheidungswirkung" style="display: flex; gap: 12px;">
                  <label class="form-radio-item" style="flex: 1;"><input type="radio" class="form-radio" name="entscheidungswirkung" value="ja" required><span class="form-radio-label">Ja</span></label>
                  <label class="form-radio-item" style="flex: 1;"><input type="radio" class="form-radio" name="entscheidungswirkung" value="nein"><span class="form-radio-label">Nein</span></label>
                  <label class="form-radio-item" style="flex: 1;"><input type="radio" class="form-radio" name="entscheidungswirkung" value="unklar"><span class="form-radio-label">Unklar</span></label>
                </div>
              </div>

              <!-- TRIGGER 2: KRITIS-Relevanz -->
              <div class="form-group">
                <label class="form-label form-label-required">
                  <i data-lucide="shield-alert" class="icon-sm icon-with-text" style="color: var(--navy);"></i>
                  KRITIS-Relevanz
                </label>
                <span class="form-hint" style="margin-bottom: 12px; display: block;">Betrifft der Case kritische Infrastruktur (Energieversorgung, IT-Systeme)?</span>
                <div class="form-radio-group" id="kritisRelevanz" style="display: flex; gap: 12px;">
                  <label class="form-radio-item" style="flex: 1;"><input type="radio" class="form-radio" name="kritisRelevanz" value="ja" required><span class="form-radio-label">Ja</span></label>
                  <label class="form-radio-item" style="flex: 1;"><input type="radio" class="form-radio" name="kritisRelevanz" value="nein"><span class="form-radio-label">Nein</span></label>
                  <label class="form-radio-item" style="flex: 1;"><input type="radio" class="form-radio" name="kritisRelevanz" value="unklar"><span class="form-radio-label">Unklar</span></label>
                </div>
              </div>

              <!-- TRIGGER 3: Personenbezogene Daten -->
              <div class="form-group">
                <label class="form-label form-label-required">
                  <i data-lucide="user-check" class="icon-sm icon-with-text" style="color: var(--navy);"></i>
                  Personenbezogene Daten
                </label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 12px;">
                  <div>
                    <span class="form-hint" style="margin-bottom: 8px; display: block;">Werden personenbezogene Daten verarbeitet?</span>
                    <div class="form-radio-group" id="personenbezogen" style="display: flex; gap: 8px;">
                      <label class="form-radio-item" style="flex: 1; padding: 10px;"><input type="radio" class="form-radio" name="personenbezogen" value="ja" required><span class="form-radio-label">Ja</span></label>
                      <label class="form-radio-item" style="flex: 1; padding: 10px;"><input type="radio" class="form-radio" name="personenbezogen" value="nein"><span class="form-radio-label">Nein</span></label>
                      <label class="form-radio-item" style="flex: 1; padding: 10px;"><input type="radio" class="form-radio" name="personenbezogen" value="unklar"><span class="form-radio-label">Unklar</span></label>
                    </div>
                  </div>
                  <div>
                    <span class="form-hint" style="margin-bottom: 8px; display: block;">Besondere Kategorien (Art. 9 DSGVO)?</span>
                    <div class="form-radio-group" id="besondereKategorien" style="display: flex; gap: 8px;">
                      <label class="form-radio-item" style="flex: 1; padding: 10px;"><input type="radio" class="form-radio" name="besondereKategorien" value="ja"><span class="form-radio-label">Ja</span></label>
                      <label class="form-radio-item" style="flex: 1; padding: 10px;"><input type="radio" class="form-radio" name="besondereKategorien" value="nein"><span class="form-radio-label">Nein</span></label>
                      <label class="form-radio-item" style="flex: 1; padding: 10px;"><input type="radio" class="form-radio" name="besondereKategorien" value="unklar"><span class="form-radio-label">Unklar</span></label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- TRIGGER 4: Automationsgrad -->
              <div class="form-group" style="margin-bottom: 0;">
                <label class="form-label form-label-required">
                  <i data-lucide="cpu" class="icon-sm icon-with-text" style="color: var(--navy);"></i>
                  Automationsgrad
                </label>
                <span class="form-hint" style="margin-bottom: 12px; display: block;">Wie stark greift die KI in den Prozess ein?</span>
                <div class="form-radio-group" id="automationsgrad">
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="automationsgrad" value="informierend" required><span class="form-radio-label"><strong>Informierend</strong> – KI liefert nur Informationen</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="automationsgrad" value="entscheidungsunterstuetzend"><span class="form-radio-label"><strong>Entscheidungsunterstützend</strong> – KI gibt Empfehlungen, Mensch entscheidet</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="automationsgrad" value="teilautomatisiert"><span class="form-radio-label"><strong>Teilautomatisiert</strong> – KI führt Teilschritte selbstständig aus</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="automationsgrad" value="vollautomatisiert"><span class="form-radio-label"><strong>Vollautomatisiert</strong> – KI handelt ohne menschliche Freigabe</span></label>
                </div>
              </div>

              <!-- TRIGGER-STATUS ANZEIGE (dynamisch) -->
              <div id="triggerStatusDisplay" style="margin-top: 24px; padding: 16px; border-radius: 8px; background: white; border: 1px solid var(--border-gray); display: none;">
                <div style="display: flex; align-items: center; gap: 10px;">
                  <span id="triggerStatusIcon" style="font-size: 24px;">⚪</span>
                  <div>
                    <strong id="triggerStatusText" style="color: var(--text-dark);">Status wird ermittelt...</strong>
                    <p id="triggerStatusHint" style="margin: 4px 0 0; font-size: 12px; color: var(--text-medium);"></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- FORM ACTIONS -->
            <div class="form-actions">
              <div class="form-actions-left">
                <button type="button" class="btn btn-secondary" onclick="goToPreviousCase()">← Vorheriger Case</button>
                <button type="button" class="btn btn-tertiary" onclick="clearForm()"><i data-lucide="trash-2" class="icon-sm"></i> Formular leeren</button>
              </div>
              <div class="form-actions-right">
                <button type="button" class="btn btn-secondary" onclick="saveAndStay()"><i data-lucide="save" class="icon-sm"></i> Zwischenspeichern</button>
                <button type="button" class="btn btn-primary btn-lg" onclick="saveAndNext()">Speichern & Nächster Case →</button>
              </div>
            </div>
            
          </form>
          
        </div><!-- /form-container -->
        
        <!-- SUCCESS MODAL -->
        <div id="successModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); z-index: 1000; align-items: center; justify-content: center;">
          <div style="background: var(--white); padding: var(--space-10); border-radius: var(--border-radius-xl); text-align: center; max-width: 400px; border: 1px solid var(--border-gray); box-shadow: var(--shadow-lg);">
            <div style="margin-bottom: var(--space-4);"><i data-lucide="check-circle" class="icon-2xl icon-success"></i></div>
            <h2 style="margin-bottom: var(--space-2); color: var(--text-darkest);" id="modalTitle">Case #01 gespeichert!</h2>
            <p style="color: var(--text-medium); margin-bottom: var(--space-6);" id="modalText">Das Formular wurde geleert. Bereit für den nächsten Case.</p>
            <button class="btn btn-primary" onclick="closeModal()">Weiter</button>
          </div>
        </div>
        
      </div><!-- /container -->
      
    </main>
    
    <!-- FOOTER -->
    <footer class="footer">
      <div class="footer-inner">
        <span>© 2026 gannaca AI Case Sprint</span>
      </div>
    </footer>
    
  </div><!-- /page-wrapper -->
  
  <!-- ============================================
       JAVASCRIPT
       ============================================ -->
  <script>
    // Edit-Modus Tracking
    let editMode = false;
    let editCaseNumber = null;

    // Beim Laden der Seite
    document.addEventListener('DOMContentLoaded', function() {
      updateUI();
      updateTime();

      // Prüfen ob Edit-Modus (URL Parameter ?edit=X)
      const urlParams = new URLSearchParams(window.location.search);
      const editParam = urlParams.get('edit');
      if (editParam) {
        editCaseNumber = parseInt(editParam);
        loadCaseForEdit(editCaseNumber);
      }
      
      // Markiere aktuellen Tab als "active"
      const currentPage = window.location.pathname.split('/').pop();
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.getAttribute('href') === currentPage) {
          tab.classList.add('active');
        }
      });
      setInterval(updateTime, 60000); // Zeit jede Minute aktualisieren
      
      // Rating Items klickbar machen
      document.querySelectorAll('.form-rating-item').forEach(item => {
        item.addEventListener('click', function() {
          this.parentElement.querySelectorAll('.form-rating-item').forEach(i => i.classList.remove('selected'));
          this.classList.add('selected');
          this.querySelector('input').checked = true;
        });
      });
      
      // Checkbox/Radio Styling
      document.querySelectorAll('.form-checkbox, .form-radio').forEach(input => {
        input.addEventListener('change', function() {
          if (this.type === 'checkbox') {
            this.closest('.form-checkbox-item').classList.toggle('selected', this.checked);
          } else {
            document.querySelectorAll(`input[name="${this.name}"]`).forEach(r => {
              r.closest('.form-radio-item').classList.remove('selected');
            });
            this.closest('.form-radio-item').classList.add('selected');
          }
        });
      });
      
      // ============================================
      // GESAMTAUFWAND AUTO-BERECHNUNG (Schritt 5 + 6)
      // ============================================
      // Event-Listener für Häufigkeit (Radio-Buttons)
      document.querySelectorAll('input[name="haeufigkeit"]').forEach(radio => {
        radio.addEventListener('change', calculateYearlyEffort);
      });
      
      // Event-Listener für numerische Eingaben
      ['anzahlVorgaenge', 'zeitaufwandWert', 'betroffenePersonen'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('input', calculateYearlyEffort);
          el.addEventListener('change', calculateYearlyEffort);
        }
      });
      
      // Event-Listener für Zeiteinheit
      const zeitEinheit = document.getElementById('zeitaufwandEinheit');
      if (zeitEinheit) {
        zeitEinheit.addEventListener('change', calculateYearlyEffort);
      }
      
      // ============================================
      // AUTO-EXPAND TEXTAREAS
      // Textareas wachsen automatisch mit dem Inhalt!
      // ============================================
      initAutoExpandTextareas();
      
      // ============================================
      // SMOOTH SCROLL-TO-FIELD
      // Scrollt smooth zum Feld beim Fokus
      // ============================================
      setupSmoothScrollToField();
    });
    
    // ============================================
    // CASE FÜR BEARBEITUNG LADEN
    // ============================================
    function loadCaseForEdit(caseNumber) {
      const cases = getAllCases();
      const caseData = cases.find(c => c.caseNumber === caseNumber);

      if (!caseData) {
        toastError('Case nicht gefunden', `Case #${caseNumber} existiert nicht.`);
        return;
      }

      editMode = true;

      // Header aktualisieren
      const pageTitle = document.querySelector('.page-title');
      if (pageTitle) {
        pageTitle.innerHTML = `<i data-lucide="edit-3" class="icon-with-text"></i>Case #${caseNumber.toString().padStart(2, '0')} bearbeiten`;
        lucide.createIcons();
      }

      const pageSubtitle = document.querySelector('.page-subtitle');
      if (pageSubtitle) {
        pageSubtitle.textContent = 'Änderungen vornehmen und speichern';
      }

      // Case-Nummer anzeigen
      const caseNumDisplay = document.getElementById('caseNumber');
      if (caseNumDisplay) caseNumDisplay.textContent = `#${caseNumber.toString().padStart(2, '0')}`;

      // Formularfelder befüllen
      populateFormField('teilnehmer', caseData.teilnehmer);
      populateFormField('problemTitel', caseData.problemTitel);
      populateFormField('ausgangslage', caseData.ausgangslage);
      populateFormField('problem', caseData.problem);
      populateFormField('anzahlVorgaenge', caseData.anzahlVorgaenge);
      populateFormField('zeitaufwandWert', caseData.zeitaufwandWert);
      populateFormField('zeitaufwandEinheit', caseData.zeitaufwandEinheit);
      populateFormField('betroffenePersonen', caseData.betroffenePersonen);
      populateFormField('risikoBegruendung', caseData.risikoBegruendung);
      populateFormField('vorhandeneLösungBeschreibung', caseData.vorhandeneLösungBeschreibung);
      populateFormField('kiPotenzial', caseData.kiPotenzial);

      // Radio-Buttons
      selectRadio('haeufigkeit', caseData.haeufigkeit);
      selectRadio('strategischeRelevanz', caseData.strategischeRelevanz);
      selectRadio('vorhandeneLoesung', caseData.vorhandeneLoesung);
      selectRadio('datenVerfuegbarkeit', caseData.datenVerfuegbarkeit);

      // Rating (Risiko)
      if (caseData.risiko) {
        const risikoInput = document.querySelector(`input[name="risiko"][value="${caseData.risiko}"]`);
        if (risikoInput) {
          risikoInput.checked = true;
          risikoInput.closest('.form-rating-item')?.classList.add('selected');
        }
      }

      // Checkboxen (Abteilungen)
      if (caseData.abteilungen && Array.isArray(caseData.abteilungen)) {
        caseData.abteilungen.forEach(abt => {
          const checkbox = document.querySelector(`input[name="abteilung"][value="${abt}"]`);
          if (checkbox) {
            checkbox.checked = true;
            checkbox.closest('.form-checkbox-item')?.classList.add('selected');
          }
        });
      }

      // Governance Trigger
      selectRadio('entscheidungswirkung', caseData.entscheidungswirkung);
      selectRadio('kritisRelevanz', caseData.kritisRelevanz);
      selectRadio('personenbezogen', caseData.personenbezogen);
      selectRadio('besondereKategorien', caseData.besondereKategorien);
      selectRadio('automationsgrad', caseData.automationsgrad);

      // Auto-Expand für befüllte Textareas
      document.querySelectorAll('textarea').forEach(ta => {
        if (ta.value) autoExpandTextarea(ta);
      });

      // Gesamtaufwand neu berechnen
      calculateYearlyEffort();

      // Erfolgs-Toast
      toastSuccess('Case geladen', `Case #${caseNumber.toString().padStart(2, '0')} wurde zur Bearbeitung geladen.`);
    }

    function populateFormField(id, value) {
      const field = document.getElementById(id);
      if (field && value !== undefined && value !== null) {
        field.value = value;
      }
    }

    function selectRadio(name, value) {
      if (!value) return;
      const radio = document.querySelector(`input[name="${name}"][value="${value}"]`);
      if (radio) {
        radio.checked = true;
        radio.closest('.form-radio-item')?.classList.add('selected');
      }
    }

    // ============================================
    // SMOOTH SCROLL-TO-FIELD FUNKTION
    // Zentriert das fokussierte Feld im Viewport
    // ============================================
    function setupSmoothScrollToField() {
      const formFields = document.querySelectorAll(
        'input[type="text"], input[type="number"], textarea, select'
      );
      
      formFields.forEach(field => {
        field.addEventListener('focus', function() {
          // Kurze Verzögerung für bessere UX
          setTimeout(() => {
            scrollToFieldSmooth(this);
          }, 150);
        });
      });
    }
    
    function scrollToFieldSmooth(field) {
      // Nutze scroll-margin-top auf .form-section, um Sticky-Header zu berücksichtigen
      const section = field.closest('.form-section') || field;
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    // ============================================
    // AUTO-EXPAND TEXTAREA FUNKTION
    // Keine scrollbaren Textareas - sie wachsen mit!
    // ============================================
    function autoExpandTextarea(textarea) {
      // Höhe zurücksetzen, um echte Inhaltshöhe zu messen
      textarea.style.height = 'auto';
      
      // Neue Höhe basierend auf scrollHeight (= echter Inhalt)
      const newHeight = Math.max(textarea.scrollHeight, 120); // Mindestens 120px
      textarea.style.height = newHeight + 'px';
    }
    
    function initAutoExpandTextareas() {
      // Alle Textareas auf der Seite finden
      document.querySelectorAll('textarea').forEach(textarea => {
        // Initiale Mindesthöhe
        textarea.style.minHeight = '120px';
        
        // Event-Listener für Auto-Expand bei Eingabe
        textarea.addEventListener('input', function() {
          autoExpandTextarea(this);
        });
        
        // Event-Listener für Paste (eingefügter Text)
        textarea.addEventListener('paste', function() {
          // Kurze Verzögerung, damit der Text erst eingefügt wird
          setTimeout(() => autoExpandTextarea(this), 10);
        });
        
        // Initiale Berechnung falls bereits Inhalt vorhanden
        if (textarea.value) {
          autoExpandTextarea(textarea);
        }
        
        // Bullet-Point-Funktion aktivieren
        enableBulletPoints(textarea);
      });
    }
    
    // ============================================
    // BULLET-POINT AUTO-FORMATTING
    // Bei Enter → automatisch "- " auf neuer Zeile
    // ============================================
    function enableBulletPoints(textarea) {
      textarea.addEventListener('keydown', function(event) {
        // Nur bei Enter-Taste
        if (event.key === 'Enter') {
          const start = this.selectionStart;
          const end = this.selectionEnd;
          const text = this.value;
          
          // Finde Anfang der aktuellen Zeile
          let lineStart = text.lastIndexOf('\n', start - 1) + 1;
          let currentLine = text.substring(lineStart, start);
          
          // Prüfe, ob aktuelle Zeile mit Bullet-Point beginnt (- oder •)
          const bulletMatch = currentLine.match(/^(\s*)([-•])\s/);
          
          if (bulletMatch) {
            // Aktuelle Zeile hat Bullet-Point
            const indentation = bulletMatch[1];
            const bulletChar = bulletMatch[2];
            
            // Prüfe, ob Zeile NUR aus Bullet-Point besteht (leer)
            if (currentLine.trim() === '-' || currentLine.trim() === '•') {
              // Leere Bullet-Zeile → Bullet entfernen, aus Liste aussteigen
              event.preventDefault();
              this.value = text.substring(0, lineStart) + text.substring(start);
              this.selectionStart = this.selectionEnd = lineStart;
            } else {
              // Normale Bullet-Zeile → neue Zeile mit Bullet
              event.preventDefault();
              const newText = '\n' + indentation + bulletChar + ' ';
              this.value = text.substring(0, start) + newText + text.substring(end);
              this.selectionStart = this.selectionEnd = start + newText.length;
            }
          } else if (currentLine.trim() !== '') {
            // Erste Zeile mit Inhalt, aber kein Bullet → Bullet hinzufügen
            event.preventDefault();
            this.value = text.substring(0, start) + '\n- ' + text.substring(end);
            this.selectionStart = this.selectionEnd = start + 3;
          }
          // Sonst: Normale Enter-Taste (Standard-Verhalten)
          
          // Auto-Expand auslösen
          autoExpandTextarea(this);
        }
      });
    }
    
    // ============================================
    // GESAMTAUFWAND BERECHNUNG
    // Formel: Vorgänge × Häufigkeit × Zeit × Personen
    // ============================================
    function calculateYearlyEffort() {
      const gesamtaufwandField = document.getElementById('gesamtaufwand');
      const hintField = document.getElementById('gesamtaufwandHint');
      const formelField = document.getElementById('gesamtaufwandFormel');
      
      // Häufigkeit auslesen
      const haeufigkeitRadio = document.querySelector('input[name="haeufigkeit"]:checked');
      const haeufigkeit = haeufigkeitRadio ? haeufigkeitRadio.value : '';
      
      // Anzahl Vorgänge auslesen
      const anzahlVorgaenge = parseFloat(document.getElementById('anzahlVorgaenge').value) || 0;
      
      // Anzahl betroffene Personen auslesen
      const anzahlPersonen = parseFloat(document.getElementById('betroffenePersonen').value) || 1;
      
      // Zeitaufwand auslesen
      const zeitWert = parseFloat(document.getElementById('zeitaufwandWert').value) || 0;
      const zeitEinheit = document.getElementById('zeitaufwandEinheit').value;
      
      // Prüfen ob genug Daten vorhanden (mindestens Häufigkeit + Vorgänge + Zeit)
      if (!haeufigkeit || anzahlVorgaenge <= 0 || zeitWert <= 0) {
        gesamtaufwandField.value = '';
        gesamtaufwandField.placeholder = 'Wird berechnet...';
        gesamtaufwandField.style.backgroundColor = 'var(--color-bg-light)';
        hintField.style.display = 'none';
        formelField.innerHTML = '<i data-lucide="calculator" class="icon-sm"></i> = Vorgänge × Häufigkeit × Zeit × Personen';
        lucide.createIcons();
        return;
      }
      
      // Visuelles Feedback: Gelb während Berechnung
      gesamtaufwandField.style.backgroundColor = '#FFF3CD';
      
      // Multiplikator basierend auf Häufigkeit (auf Jahresbasis)
      let multiplier = 1;
      let haeufigkeitLabel = '';
      let canCalculate = true;
      switch(haeufigkeit) {
        case 'Täglich':
          multiplier = 250; // Arbeitstage
          haeufigkeitLabel = '×250';
          break;
        case 'Wöchentlich':
          multiplier = 52;
          haeufigkeitLabel = '×52';
          break;
        case 'Monatlich':
          multiplier = 12;
          haeufigkeitLabel = '×12';
          break;
        case 'Quartalsweise':
          multiplier = 4;
          haeufigkeitLabel = '×4';
          break;
        case 'Jährlich':
          multiplier = 1;
          haeufigkeitLabel = '×1';
          break;
        case 'Unregelmäßig':
        case 'Unbestimmt':
          canCalculate = false;
          break;
      }
      
      // Bei Unregelmäßig/Unbestimmt keine Berechnung möglich
      if (!canCalculate) {
        gesamtaufwandField.value = 'Keine Berechnung möglich';
        gesamtaufwandField.style.backgroundColor = '#F0F0F0';
        hintField.style.display = 'none';
        formelField.innerHTML = '<i data-lucide="info" class="icon-sm"></i> Häufigkeit zu unbestimmt für Berechnung';
        lucide.createIcons();
        return;
      }
      
      // Berechnung: Vorgänge × Multiplikator × Zeit × Personen
      let totalMinutesPerYear = anzahlVorgaenge * multiplier * zeitWert * anzahlPersonen;
      
      // Falls Eingabe in Stunden, in Minuten umrechnen
      if (zeitEinheit === 'hours') {
        totalMinutesPerYear = totalMinutesPerYear * 60;
      }
      
      // In Stunden umrechnen für Anzeige
      const totalHoursPerYear = totalMinutesPerYear / 60;
      
      // Nach 300ms: Ergebnis anzeigen
      setTimeout(() => {
        // Ergebnis formatieren
        if (totalHoursPerYear >= 1) {
          gesamtaufwandField.value = totalHoursPerYear.toLocaleString('de-DE', {maximumFractionDigits: 0}) + ' Std/Jahr';
        } else {
          gesamtaufwandField.value = totalMinutesPerYear.toLocaleString('de-DE', {maximumFractionDigits: 0}) + ' Min/Jahr';
        }
        
        // Grüner Hintergrund
        gesamtaufwandField.style.backgroundColor = '#D4EDDA';
        hintField.style.display = 'block';
        
        // Formel mit konkreten Werten anzeigen
        const zeitLabel = zeitEinheit === 'hours' ? 'Std' : 'Min';
        formelField.innerHTML = `<i data-lucide="calculator" class="icon-sm"></i> ${anzahlVorgaenge}${haeufigkeitLabel} × ${zeitWert}${zeitLabel} × ${anzahlPersonen}Pers.`;
        lucide.createIcons();
      }, 300);
    }
    
    // UI aktualisieren
    function updateUI() {
      const cases = getAllCases();
      const nextNumber = cases.length + 1;
      
      // Case-Nummer
      document.getElementById('caseNumber').textContent = '#' + nextNumber.toString().padStart(2, '0');
    }
    
    // Zeit aktualisieren
    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent = now.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'}) + ' Uhr';
    }
    
    // Formular-Daten sammeln
    function collectFormData() {
      // Abteilungen sammeln (inkl. Freifeld falls ausgefüllt)
      const abteilungen = Array.from(document.querySelectorAll('input[name="abteilung"]:checked'))
        .map(cb => cb.value)
        .filter(val => val !== 'Weitere'); // "Weitere" selbst nicht als Wert
      const weitereAbteilung = document.getElementById('abteilungWeitere')?.value;
      if (weitereAbteilung) {
        abteilungen.push(weitereAbteilung);
      }
      
      const data = {
        erfasstVon: 'Melissa Conrads', // Statisch - kein Dropdown nötig
        ausgangslage: document.getElementById('ausgangslage').value,
        abteilungen: abteilungen,
        lage: document.getElementById('lage').value,
        prozessablauf: document.getElementById('prozessablauf').value,
        haeufigkeit: document.querySelector('input[name="haeufigkeit"]:checked')?.value || '',
        anzahlVorgaenge: document.getElementById('anzahlVorgaenge').value,
        betroffenePersonen: document.getElementById('betroffenePersonen').value,
        qualifizierungsgrad: document.getElementById('qualifizierungsgrad').value,
        zeitaufwandWert: document.getElementById('zeitaufwandWert').value,
        zeitaufwandEinheit: document.getElementById('zeitaufwandEinheit').value,
        gesamtaufwandJahr: document.getElementById('gesamtaufwand').value, // Berechneter Wert
        strategischeRelevanz: document.querySelector('input[name="relevanz"]:checked')?.value || '',
        risiko: document.querySelector('input[name="risiko"]:checked')?.value || '',
        risikoBegruendung: document.getElementById('risikoBegruendung').value,
        vorhandeneLoesung: document.querySelector('input[name="vorhandeneLoesung"]:checked')?.value || '',
        vorhandeneLösungBeschreibung: document.getElementById('vorhandeneLösungBeschreibung').value,
        datenVerfuegbarkeit: document.querySelector('input[name="datenVerfuegbarkeit"]:checked')?.value || '',
        datenDetails: document.getElementById('datenDetails')?.value || '',
        vorstellung: document.getElementById('vorstellung').value
      };
      return data;
    }
    
    // Validierung
    function validateForm() {
      const ausgangslage = document.getElementById('ausgangslage').value.trim();
      const lage = document.getElementById('lage').value.trim();
      const prozessablauf = document.getElementById('prozessablauf').value.trim();
      
      if (!ausgangslage) {
        toastWarning('Pflichtfeld fehlt', 'Bitte beschreibe die Ausgangslage.');
        document.getElementById('ausgangslage').focus();
        return false;
      }
      if (!lage) {
        toastWarning('Pflichtfeld fehlt', 'Bitte beschreibe die Lage.');
        document.getElementById('lage').focus();
        return false;
      }
      if (!prozessablauf) {
        toastWarning('Pflichtfeld fehlt', 'Bitte beschreibe den Prozessablauf.');
        document.getElementById('prozessablauf').focus();
        return false;
      }
      return true;
    }
    
    // Speichern und weiter
    function saveAndNext() {
      if (!validateForm()) return;

      const data = collectFormData();
      let caseNum;

      if (editMode && editCaseNumber) {
        // Im Edit-Modus: Case aktualisieren
        updateCase(editCaseNumber, data);
        caseNum = editCaseNumber;
        document.getElementById('modalTitle').textContent = `Case #${caseNum.toString().padStart(2, '0')} aktualisiert!`;
      } else {
        // Neuer Case
        caseNum = saveCase(data);
        document.getElementById('modalTitle').textContent = `Case #${caseNum.toString().padStart(2, '0')} gespeichert!`;
      }

      // Modal zeigen
      document.getElementById('successModal').style.display = 'flex';

      // Formular leeren und Edit-Modus beenden
      clearForm();
      editMode = false;
      editCaseNumber = null;
      // URL Parameter entfernen
      window.history.replaceState({}, '', window.location.pathname);
      updateUI();
    }

    // Speichern und bleiben
    function saveAndStay() {
      if (!validateForm()) return;

      const data = collectFormData();
      let caseNum;

      if (editMode && editCaseNumber) {
        // Im Edit-Modus: Case aktualisieren
        updateCase(editCaseNumber, data);
        caseNum = editCaseNumber;
        toastSuccess(`Case #${caseNum.toString().padStart(2, '0')} aktualisiert`, 'Änderungen wurden gespeichert.');
      } else {
        // Neuer Case
        caseNum = saveCase(data);
        toastSuccess(`Case #${caseNum.toString().padStart(2, '0')} gespeichert`, 'Sie können nun Änderungen vornehmen oder zur Ergebnis-Übersicht wechseln.');
      }

      updateUI();
    }
    
    // Formular leeren
    function clearForm() {
      document.getElementById('caseForm').reset();
      document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
      
      // Gesamtaufwand-Feld zurücksetzen
      const gesamtaufwandField = document.getElementById('gesamtaufwand');
      const hintField = document.getElementById('gesamtaufwandHint');
      gesamtaufwandField.value = '';
      gesamtaufwandField.placeholder = 'Wird berechnet...';
      gesamtaufwandField.style.backgroundColor = 'var(--color-bg-light)';
      hintField.style.display = 'none';
      
      // Weitere Abteilung Freifeld zurücksetzen
      const weitereContainer = document.getElementById('weitereAbteilungContainer');
      if (weitereContainer) {
        weitereContainer.style.display = 'none';
      }
      
      updateUI();
    }
    
    // Zum vorherigen Case
    function goToPreviousCase() {
      const cases = getAllCases();
      if (cases.length === 0) {
        toastInfo('Keine Cases vorhanden', 'Es gibt noch keine gespeicherten Cases.');
        return;
      }
      
      // Zur Ergebnis-Seite wechseln
      window.location.href = 'screen-7-results.html';
    }
    
    // Modal schließen
    function closeModal() {
      document.getElementById('successModal').style.display = 'none';
    }
    
    // Weitere Abteilung Freifeld ein-/ausblenden
    function toggleWeitereAbteilung() {
      const checkbox = document.getElementById('abteilungWeitereCheckbox');
      const container = document.getElementById('weitereAbteilungContainer');
      if (checkbox && container) {
        container.style.display = checkbox.checked ? 'block' : 'none';
        if (!checkbox.checked) {
          document.getElementById('abteilungWeitere').value = '';
        }
      }
    }
  </script>
  
  <!-- FOKUS-MODUS NAVIGATION BAR - OPTIMIERT -->
  <div class="focus-nav" id="focusNav">
    <div class="focus-nav-inner">
      <!-- LINKE SEITE: Fortschritt & Info -->
      <div class="focus-nav-progress">
        <span class="focus-nav-step">FRAGE <span class="focus-nav-step-number" id="focusStepNumber">1 / 11</span></span>
        <span class="focus-nav-title" id="focusStepTitle">Beschreibung der Ausgangslage</span>
        <div class="focus-nav-dots" id="focusDots"></div>
      </div>

      <!-- RECHTE SEITE: Buttons -->
      <div class="focus-nav-buttons">
        <!-- Auto-Save Indikator -->
        <div class="autosave-indicator" id="autosaveIndicator">
          <i data-lucide="cloud" id="autosaveIcon"></i>
          <span id="autosaveText">Entwurf gespeichert</span>
        </div>

        <button class="focus-nav-btn focus-nav-btn-prev" id="focusPrevBtn" onclick="focusPrevStep()" title="Vorherige Frage (←)">
          <i data-lucide="arrow-left"></i> Zurück
        </button>
        <button class="focus-nav-btn focus-nav-btn-next" id="focusNextBtn" onclick="focusNextStep()" title="Nächste Frage (→)">
          Weiter <i data-lucide="arrow-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- BESTÄTIGUNGSDIALOG -->
  <div class="confirm-dialog-overlay" id="confirmDialog" style="display: none;">
    <div class="confirm-dialog">
      <div class="confirm-dialog-header">
        <h3><i data-lucide="clipboard-check" style="width:24px;height:24px;color:var(--navy);"></i> Case speichern?</h3>
      </div>
      <div class="confirm-dialog-body">
        <div class="confirm-dialog-summary">
          <h4>Zusammenfassung</h4>
          <div class="confirm-dialog-stat">
            <span class="confirm-dialog-stat-label">Case-Nummer</span>
            <span class="confirm-dialog-stat-value" id="confirmCaseNumber">#01</span>
          </div>
          <div class="confirm-dialog-stat">
            <span class="confirm-dialog-stat-label">Ausgefüllte Felder</span>
            <span class="confirm-dialog-stat-value success" id="confirmFilledFields">8 / 11</span>
          </div>
          <div class="confirm-dialog-stat">
            <span class="confirm-dialog-stat-label">Leere Pflichtfelder</span>
            <span class="confirm-dialog-stat-value" id="confirmEmptyRequired">0</span>
          </div>
        </div>
        <p style="font-size: 14px; color: var(--text-medium); margin: 0;" id="confirmMessage">
          Alle Pflichtfelder sind ausgefüllt. Der Case kann gespeichert werden.
        </p>
      </div>
      <div class="confirm-dialog-footer">
        <button class="confirm-dialog-btn confirm-dialog-btn-cancel" onclick="closeConfirmDialog()">Abbrechen</button>
        <button class="confirm-dialog-btn confirm-dialog-btn-confirm" onclick="confirmSaveCase()">
          <i data-lucide="check" style="width:16px;height:16px;"></i> Speichern
        </button>
      </div>
    </div>
  </div>
  
  <!-- FOKUS-MODUS JAVASCRIPT - OPTIMIERT -->
  <script>
    let focusModeActive = false;
    let currentFocusStep = 0;
    const totalSteps = 11;
    let autoSaveTimer = null;
    const AUTOSAVE_KEY = 'gannaca_case_draft';

    // FRAGETITEL - Für Navigation und Tooltips
    const questionTitles = [
      'Beschreibung der Ausgangslage',
      'Betroffene Abteilung(en)',
      'Was ist die Lage?',
      'Prozessablauf',
      'Häufigkeit',
      'Betroffene Personen & Zeitaufwand',
      'Strategische Relevanz',
      'Risiko bei Nicht-Handlung',
      'Vorhandene Lösungsansätze',
      'Daten-Verfügbarkeit',
      'Welche Art von Unterstützung wäre hilfreich?'
    ];

    // KURZFORM für Tooltips
    const questionShortTitles = [
      'Ausgangslage',
      'Abteilungen',
      'Lage',
      'Prozess',
      'Häufigkeit',
      'Personen & Zeit',
      'Relevanz',
      'Risiko',
      'Lösungen',
      'Daten',
      'Unterstützung'
    ];

    // ============================================
    // FOKUS-MODUS TOGGLE
    // ============================================
    function toggleFocusMode() {
      focusModeActive = !focusModeActive;
      const body = document.body;
      const btn = document.getElementById('focusModeToggle');
      const icon = document.getElementById('focusModeIcon');
      const label = document.getElementById('focusModeLabel');

      if (focusModeActive) {
        body.classList.add('focus-mode-active');
        btn.classList.add('active');
        icon.setAttribute('data-lucide', 'minimize-2');
        label.textContent = 'Beenden';
        currentFocusStep = 0;
        initFocusDots();
        showFocusStep(currentFocusStep);
        // Auto-Save aktivieren
        initAutoSave();
        restoreDraft();
      } else {
        body.classList.remove('focus-mode-active');
        btn.classList.remove('active');
        icon.setAttribute('data-lucide', 'maximize-2');
        label.textContent = 'Fokus';
        showAllSteps();
      }
      lucide.createIcons();
    }

    // ============================================
    // DOTS MIT NUMMERN UND TOOLTIPS
    // ============================================
    function initFocusDots() {
      const dotsContainer = document.getElementById('focusDots');
      dotsContainer.innerHTML = '';

      for (let i = 0; i < totalSteps; i++) {
        const dot = document.createElement('div');
        dot.className = 'focus-nav-dot' + (i === 0 ? ' active' : '');
        dot.textContent = (i + 1); // Nummer im Dot
        dot.setAttribute('data-tooltip', questionShortTitles[i]);
        dot.onclick = () => showFocusStep(i);
        dot.style.cursor = 'pointer';
        dot.id = `focusDot${i}`;
        dotsContainer.appendChild(dot);
      }

      // Initial: Prüfen welche Felder bereits ausgefüllt sind
      updateDotStates();
    }

    // ============================================
    // DOT-STATUS AKTUALISIEREN (ausgefüllt/leer)
    // ============================================
    function updateDotStates() {
      const sections = document.querySelectorAll('.form-section');
      sections.forEach((section, i) => {
        const dot = document.getElementById(`focusDot${i}`);
        if (!dot) return;

        const hasData = sectionHasData(section);
        dot.classList.toggle('has-data', hasData);
      });
    }

    function sectionHasData(section) {
      // Prüfe ob irgendein Feld in der Section Daten hat
      const inputs = section.querySelectorAll('input[type="text"], input[type="number"], textarea');
      for (const input of inputs) {
        if (input.value.trim()) return true;
      }

      const checkboxes = section.querySelectorAll('input[type="checkbox"]:checked');
      if (checkboxes.length > 0) return true;

      const radios = section.querySelectorAll('input[type="radio"]:checked');
      if (radios.length > 0) return true;

      const selects = section.querySelectorAll('select');
      for (const select of selects) {
        if (select.value) return true;
      }

      return false;
    }

    // ============================================
    // FOKUS-SCHRITT ANZEIGEN
    // ============================================
    function showFocusStep(stepIndex) {
      currentFocusStep = stepIndex;
      const sections = document.querySelectorAll('.form-section');

      sections.forEach((section, i) => {
        section.classList.remove('focus-visible');
        if (i === stepIndex) {
          section.classList.add('focus-visible');
          setTimeout(() => {
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // Erstes Eingabefeld fokussieren
            const firstInput = section.querySelector('input:not([type="checkbox"]):not([type="radio"]), textarea, select');
            if (firstInput && !firstInput.readOnly) {
              firstInput.focus();
            }
          }, 100);
        }
      });

      // Update Frage-Nummer
      document.getElementById('focusStepNumber').textContent = `${stepIndex + 1} / ${totalSteps}`;

      // Update Frage-Titel
      document.getElementById('focusStepTitle').textContent = questionTitles[stepIndex];

      // Update dots
      const dots = document.querySelectorAll('.focus-nav-dot');
      dots.forEach((dot, i) => {
        dot.classList.remove('active');
        if (i === stepIndex) dot.classList.add('active');
        if (i < stepIndex) dot.classList.add('completed');
        else dot.classList.remove('completed');
      });

      // Update buttons
      document.getElementById('focusPrevBtn').disabled = stepIndex === 0;
      const nextBtn = document.getElementById('focusNextBtn');
      if (stepIndex === totalSteps - 1) {
        nextBtn.innerHTML = '<i data-lucide="save"></i> Case speichern';
        nextBtn.className = 'focus-nav-btn focus-nav-btn-save';
      } else {
        nextBtn.innerHTML = 'Weiter <i data-lucide="arrow-right"></i>';
        nextBtn.className = 'focus-nav-btn focus-nav-btn-next';
      }
      lucide.createIcons();
    }

    function focusPrevStep() {
      if (currentFocusStep > 0) {
        showFocusStep(currentFocusStep - 1);
      }
    }

    function focusNextStep() {
      if (currentFocusStep < totalSteps - 1) {
        showFocusStep(currentFocusStep + 1);
      } else {
        // Letzter Schritt: Bestätigungsdialog zeigen
        showConfirmDialog();
      }
    }

    function showAllSteps() {
      const sections = document.querySelectorAll('.form-section');
      sections.forEach(section => {
        section.classList.remove('focus-visible');
      });
    }

    // ============================================
    // AUTO-SAVE FUNKTION
    // ============================================
    function initAutoSave() {
      // Bei jeder Eingabe: Auto-Save nach 1 Sekunde Inaktivität
      const form = document.getElementById('caseForm');
      form.addEventListener('input', triggerAutoSave);
      form.addEventListener('change', triggerAutoSave);
    }

    function triggerAutoSave() {
      // Bestehenden Timer löschen
      if (autoSaveTimer) clearTimeout(autoSaveTimer);

      // Indikator: "Speichert..."
      showAutoSaveStatus('saving');

      // Nach 1 Sekunde speichern
      autoSaveTimer = setTimeout(() => {
        saveDraft();
        showAutoSaveStatus('saved');
        updateDotStates();
      }, 1000);
    }

    function showAutoSaveStatus(status) {
      const indicator = document.getElementById('autosaveIndicator');
      const icon = document.getElementById('autosaveIcon');
      const text = document.getElementById('autosaveText');

      indicator.className = 'autosave-indicator ' + status;

      if (status === 'saving') {
        icon.setAttribute('data-lucide', 'loader');
        text.textContent = 'Speichert...';
      } else {
        icon.setAttribute('data-lucide', 'cloud-check');
        text.textContent = 'Entwurf gespeichert';
      }
      lucide.createIcons();
    }

    function saveDraft() {
      const data = collectFormData();
      localStorage.setItem(AUTOSAVE_KEY, JSON.stringify(data));
    }

    function restoreDraft() {
      const draft = localStorage.getItem(AUTOSAVE_KEY);
      if (!draft) return;

      try {
        const data = JSON.parse(draft);
        // Formular mit gespeicherten Daten füllen (wenn vorhanden)
        if (data.ausgangslage) document.getElementById('ausgangslage').value = data.ausgangslage;
        if (data.lage) document.getElementById('lage').value = data.lage;
        if (data.prozessablauf) document.getElementById('prozessablauf').value = data.prozessablauf;
        if (data.anzahlVorgaenge) document.getElementById('anzahlVorgaenge').value = data.anzahlVorgaenge;
        if (data.betroffenePersonen) document.getElementById('betroffenePersonen').value = data.betroffenePersonen;
        if (data.qualifizierungsgrad) document.getElementById('qualifizierungsgrad').value = data.qualifizierungsgrad;
        if (data.zeitaufwandWert) document.getElementById('zeitaufwandWert').value = data.zeitaufwandWert;
        if (data.zeitaufwandEinheit) document.getElementById('zeitaufwandEinheit').value = data.zeitaufwandEinheit;
        if (data.risikoBegruendung) document.getElementById('risikoBegruendung').value = data.risikoBegruendung;
        if (data.vorhandeneLösungBeschreibung) document.getElementById('vorhandeneLösungBeschreibung').value = data.vorhandeneLösungBeschreibung;
        if (data.datenDetails) document.getElementById('datenDetails').value = data.datenDetails;
        if (data.vorstellung) document.getElementById('vorstellung').value = data.vorstellung;

        // Abteilungen (inkl. Freifeld-Wiederherstellung)
        if (data.abteilungen && data.abteilungen.length > 0) {
          // Liste der vordefinierten Abteilungswerte
          const predefinedValues = Array.from(document.querySelectorAll('input[name="abteilung"]'))
            .map(cb => cb.value)
            .filter(v => v !== 'Weitere');

          const weitereAbteilungen = [];

          data.abteilungen.forEach(abt => {
            if (predefinedValues.includes(abt)) {
              // Vordefinierte Abteilung aktivieren
              const cb = document.querySelector(`input[name="abteilung"][value="${abt}"]`);
              if (cb) {
                cb.checked = true;
                cb.closest('.form-checkbox-item')?.classList.add('selected');
              }
            } else {
              // Nicht vordefiniert → ist eine "weitere" Abteilung
              weitereAbteilungen.push(abt);
            }
          });

          // Wenn es weitere Abteilungen gibt, Checkbox aktivieren und Freifeld füllen
          if (weitereAbteilungen.length > 0) {
            const weitereCheckbox = document.getElementById('abteilungWeitereCheckbox');
            const weitereContainer = document.getElementById('weitereAbteilungContainer');
            const weitereInput = document.getElementById('abteilungWeitere');

            if (weitereCheckbox && weitereContainer && weitereInput) {
              weitereCheckbox.checked = true;
              weitereCheckbox.closest('.form-checkbox-item')?.classList.add('selected');
              weitereContainer.style.display = 'block';
              weitereInput.value = weitereAbteilungen.join(', ');
            }
          }
        }

        // Radio-Buttons
        if (data.haeufigkeit) {
          const radio = document.querySelector(`input[name="haeufigkeit"][value="${data.haeufigkeit}"]`);
          if (radio) {
            radio.checked = true;
            radio.closest('.form-radio-item')?.classList.add('selected');
          }
        }
        if (data.strategischeRelevanz) {
          const radio = document.querySelector(`input[name="relevanz"][value="${data.strategischeRelevanz}"]`);
          if (radio) {
            radio.checked = true;
            radio.closest('.form-radio-item')?.classList.add('selected');
          }
        }
        if (data.risiko) {
          const radio = document.querySelector(`input[name="risiko"][value="${data.risiko}"]`);
          if (radio) {
            radio.checked = true;
            radio.closest('.form-rating-item')?.classList.add('selected');
          }
        }
        if (data.vorhandeneLoesung) {
          const radio = document.querySelector(`input[name="vorhandeneLoesung"][value="${data.vorhandeneLoesung}"]`);
          if (radio) {
            radio.checked = true;
            radio.closest('.form-radio-item')?.classList.add('selected');
          }
        }
        if (data.datenVerfuegbarkeit) {
          const radio = document.querySelector(`input[name="datenVerfuegbarkeit"][value="${data.datenVerfuegbarkeit}"]`);
          if (radio) {
            radio.checked = true;
            radio.closest('.form-radio-item')?.classList.add('selected');
          }
        }

        // Berechnung auslösen
        calculateYearlyEffort();

        // Toast anzeigen
        toastInfo('Entwurf wiederhergestellt', 'Ihre letzte Eingabe wurde geladen.');
      } catch (e) {
        console.log('Draft restore error:', e);
      }
    }

    function clearDraft() {
      localStorage.removeItem(AUTOSAVE_KEY);
    }

    // ============================================
    // BESTÄTIGUNGSDIALOG
    // ============================================
    function showConfirmDialog() {
      // Statistiken berechnen
      const totalFields = 11;
      let filledFields = 0;
      let emptyRequired = 0;

      const sections = document.querySelectorAll('.form-section');
      sections.forEach((section, i) => {
        if (sectionHasData(section)) filledFields++;
      });

      // Pflichtfelder prüfen
      const requiredFields = [
        { id: 'ausgangslage', name: 'Ausgangslage' },
        { id: 'lage', name: 'Lage' },
        { id: 'prozessablauf', name: 'Prozessablauf' }
      ];
      const emptyRequiredFields = [];
      requiredFields.forEach(field => {
        const el = document.getElementById(field.id);
        if (!el || !el.value.trim()) {
          emptyRequired++;
          emptyRequiredFields.push(field.name);
        }
      });

      // Abteilungen prüfen
      const abteilungen = document.querySelectorAll('input[name="abteilung"]:checked');
      if (abteilungen.length === 0) {
        emptyRequired++;
        emptyRequiredFields.push('Abteilungen');
      }

      // Dialog aktualisieren
      document.getElementById('confirmCaseNumber').textContent = document.getElementById('caseNumber').textContent;
      document.getElementById('confirmFilledFields').textContent = `${filledFields} / ${totalFields}`;
      document.getElementById('confirmFilledFields').className = 'confirm-dialog-stat-value ' + (filledFields >= 8 ? 'success' : '');

      document.getElementById('confirmEmptyRequired').textContent = emptyRequired;
      document.getElementById('confirmEmptyRequired').className = 'confirm-dialog-stat-value ' + (emptyRequired > 0 ? 'warning' : 'success');

      if (emptyRequired > 0) {
        document.getElementById('confirmMessage').innerHTML = `<strong style="color:var(--orange);">Achtung:</strong> ${emptyRequiredFields.join(', ')} ${emptyRequired === 1 ? 'fehlt' : 'fehlen'} noch. Trotzdem speichern?`;
      } else {
        document.getElementById('confirmMessage').textContent = 'Alle Pflichtfelder sind ausgefüllt. Der Case kann gespeichert werden.';
      }

      // Dialog anzeigen
      document.getElementById('confirmDialog').style.display = 'flex';
      lucide.createIcons();
    }

    function closeConfirmDialog() {
      document.getElementById('confirmDialog').style.display = 'none';
    }

    function confirmSaveCase() {
      closeConfirmDialog();

      // Validierung überspringen wenn bewusst unvollständig
      const data = collectFormData();
      let caseNum;

      if (editMode && editCaseNumber) {
        // Im Edit-Modus: Case aktualisieren
        updateCase(editCaseNumber, data);
        caseNum = editCaseNumber;
        document.getElementById('modalTitle').textContent = `Case #${caseNum.toString().padStart(2, '0')} aktualisiert!`;
      } else {
        // Neuer Case
        caseNum = saveCase(data);
        document.getElementById('modalTitle').textContent = `Case #${caseNum.toString().padStart(2, '0')} gespeichert!`;
      }

      // Entwurf löschen
      clearDraft();

      // Fokus-Modus beenden
      toggleFocusMode();

      // Modal zeigen
      document.getElementById('successModal').style.display = 'flex';

      // Formular leeren und Edit-Modus beenden
      clearForm();
      editMode = false;
      editCaseNumber = null;
      window.history.replaceState({}, '', window.location.pathname);
      updateUI();
    }

    // ============================================
    // KEYBOARD NAVIGATION
    // ============================================
    document.addEventListener('keydown', (e) => {
      // Bestätigungsdialog: ESC zum Schließen
      if (document.getElementById('confirmDialog').style.display === 'flex') {
        if (e.key === 'Escape') {
          closeConfirmDialog();
        }
        return;
      }

      if (!focusModeActive) return;

      // Pfeiltasten für Navigation (Links/Rechts, Hoch/Runter, PageUp/PageDown)
      if ((e.key === 'ArrowRight' || e.key === 'ArrowDown' || e.key === 'PageDown') && !e.target.matches('input, textarea, select')) {
        e.preventDefault();
        focusNextStep();
      } else if ((e.key === 'ArrowLeft' || e.key === 'ArrowUp' || e.key === 'PageUp') && !e.target.matches('input, textarea, select')) {
        e.preventDefault();
        focusPrevStep();
      } else if (e.key === 'Escape') {
        toggleFocusMode();
      }
    });

    // Klick außerhalb des Dialogs schließt ihn
    document.getElementById('confirmDialog')?.addEventListener('click', function(e) {
      if (e.target === this) {
        closeConfirmDialog();
      }
    });
  </script>
  
  <!-- ============================================
       GOVERNANCE TRIGGER STATUS SCRIPT
       ============================================ -->
  <script>
    // Event-Listener für Governance-Trigger-Felder
    document.addEventListener('DOMContentLoaded', function() {
      const triggerFields = [
        'entscheidungswirkung',
        'kritisRelevanz',
        'personenbezogen',
        'besondereKategorien',
        'automationsgrad'
      ];

      triggerFields.forEach(fieldName => {
        document.querySelectorAll(`input[name="${fieldName}"]`).forEach(radio => {
          radio.addEventListener('change', updateTriggerStatus);
        });
      });
    });

    function updateTriggerStatus() {
      const statusDisplay = document.getElementById('triggerStatusDisplay');
      const statusIcon = document.getElementById('triggerStatusIcon');
      const statusText = document.getElementById('triggerStatusText');
      const statusHint = document.getElementById('triggerStatusHint');

      // Werte auslesen
      const entscheidung = document.querySelector('input[name="entscheidungswirkung"]:checked')?.value;
      const kritis = document.querySelector('input[name="kritisRelevanz"]:checked')?.value;
      const personenbezogen = document.querySelector('input[name="personenbezogen"]:checked')?.value;
      const besondereKat = document.querySelector('input[name="besondereKategorien"]:checked')?.value;
      const automation = document.querySelector('input[name="automationsgrad"]:checked')?.value;

      // Prüfen ob mindestens ein Feld ausgefüllt ist
      if (!entscheidung && !kritis && !personenbezogen && !automation) {
        statusDisplay.style.display = 'none';
        return;
      }

      statusDisplay.style.display = 'block';

      // Trigger-Logik: Ja oder Unklar → Prüfbedarf
      const triggers = [];

      if (entscheidung === 'ja' || entscheidung === 'unklar') {
        triggers.push('Entscheidungswirkung');
      }
      if (kritis === 'ja' || kritis === 'unklar') {
        triggers.push('KRITIS');
      }
      if (personenbezogen === 'ja' || personenbezogen === 'unklar') {
        triggers.push('Personenbezogene Daten');
      }
      if (besondereKat === 'ja' || besondereKat === 'unklar') {
        triggers.push('Besondere Kategorien');
      }
      if (automation === 'teilautomatisiert' || automation === 'vollautomatisiert') {
        triggers.push('Automationsgrad');
      }

      if (triggers.length > 0) {
        // Prüfbedarf
        statusIcon.textContent = '🟡';
        statusDisplay.style.background = '#FFF8E1';
        statusDisplay.style.borderColor = '#FFB74D';
        statusText.textContent = 'Prüfinstanz erforderlich';
        statusText.style.color = '#E65100';
        statusHint.textContent = 'Trigger: ' + triggers.join(', ');
      } else {
        // Kein Prüfbedarf
        statusIcon.textContent = '🟢';
        statusDisplay.style.background = '#E8F5E9';
        statusDisplay.style.borderColor = '#81C784';
        statusText.textContent = 'Kein Prüfbedarf';
        statusText.style.color = '#2E7D32';
        statusHint.textContent = 'Alle Trigger = Nein';
      }
    }
  </script>

  <!-- Initialize Lucide Icons -->
  <script>lucide.createIcons();</script>
</body>
</html>
