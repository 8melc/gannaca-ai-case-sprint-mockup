<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Case-Erfassung | gannaca AI-Case Sprint</title>
  
  <!-- Styles -->
  <link rel="stylesheet" href="../styles/variables.css">
  <link rel="stylesheet" href="../styles/main.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/forms.css">
  
  <!-- Google Fonts (Inter) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Storage Script -->
  <script src="../js/storage.js"></script>
</head>
<body>
  <div class="page-wrapper">
    
    <!-- NEUER HEADER -->
    <header class="main-header">
      <div class="header-container">
        <div class="header-left">
          <div class="logo-group">
            <img src="../assets/gannaca-logo.png" alt="gannaca" class="gannaca-logo">
            <div class="title-group">
              <h1 class="main-title">AI-Case Sprint</h1>
              <p class="subtitle">Standardisiertes Framework f√ºr KI-Use-Case-Entwicklung</p>
            </div>
          </div>
        </div>
        <div class="header-right">
          <img src="../assets/trianel-logo.png" alt="Trianel" class="client-logo">
          <span class="version-badge">04.02.2026</span>
        </div>
      </div>
    </header>
    
    <!-- DATENSCHUTZ-BANNER -->
    <div class="data-protection-banner">
      <div class="data-protection-banner-inner">
        <span class="data-protection-icon">üîí</span>
        <div class="data-protection-text">
          <strong>DATENSCHUTZ-KONFORM | KEINE PRODUKTIVDATEN</strong>
          Dieses Mockup dient ausschlie√ülich zur Visualisierung. Alle gezeigten Beispiele sind fiktiv.
        </div>
      </div>
    </div>
    
    <!-- NAVIGATION -->
    <nav class="nav-tabs">
      <div class="nav-tabs-inner">
        <a href="screen-0-workshop-process.html" class="nav-tab"><span class="nav-tab-number">0</span> Workshop-Prozess</a>
        <a href="screen-1-overview.html" class="nav-tab"><span class="nav-tab-number">1</span> √úbersicht</a>
        <a href="screen-2-kpi.html" class="nav-tab"><span class="nav-tab-number">2</span> KPI-Rahmen</a>
        <a href="screen-3-governance.html" class="nav-tab"><span class="nav-tab-number">3</span> Governance</a>
        <a href="screen-4-process.html" class="nav-tab"><span class="nav-tab-number">4</span> Zielprozess</a>
        <a href="screen-5-mockup.html" class="nav-tab"><span class="nav-tab-number">5</span> Visualisierung</a>
        <a href="screen-6-form.html" class="nav-tab active"><span class="nav-tab-number">6</span> Case-Erfassung ‚≠ê</a>
        <a href="screen-7-results.html" class="nav-tab"><span class="nav-tab-number">7</span> Ergebnis</a>
        <a href="screen-8-matrix.html" class="nav-tab"><span class="nav-tab-number">8</span> Matrix</a>
      </div>
    </nav>
    
    <!-- MAIN CONTENT -->
    <main class="main-content">
      
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-header-inner">
          <h1 class="page-title">üìù Live-Erfassung: Ihre Cases strukturiert dokumentiert</h1>
          <p class="page-subtitle">F√ºr alle Teilnehmer sichtbar ‚Äì Eingabe durch gannaca-Team</p>
        </div>
      </div>
      
      <div class="container">
        
        <!-- Progress Bar -->
        <div class="form-progress">
          <div class="form-progress-header">
            <span class="form-progress-label">Erfasste Cases</span>
            <span class="form-progress-count" id="progressCount">0 von ~20 (Ziel)</span>
          </div>
          <div class="form-progress-bar">
            <div class="form-progress-fill" id="progressFill" style="width: 0%;"></div>
          </div>
        </div>
        
        <!-- Form Container -->
        <div class="form-container">
          
          <!-- Form Header / Meta Info -->
          <div class="form-header">
            <div class="form-header-row">
              <div class="form-meta">
                <div class="form-meta-item">
                  <span class="form-meta-label">Case-Nummer:</span>
                  <strong style="color: var(--color-accent);" id="caseNumber">#01</strong>
                </div>
                <div class="form-meta-item">
                  <span class="form-meta-label">Erfasst von:</span>
                  <span>Melissa Conrads</span>
                </div>
                <div class="form-meta-item">
                  <span class="form-meta-label">Zeitstempel:</span>
                  <span id="currentTime">--:-- Uhr</span>
                </div>
              </div>
              <div class="form-meta">
                <div class="form-meta-item">
                  <span class="form-meta-label">Teilnehmer:</span>
                  <select class="form-select" id="teilnehmer" style="width: auto; min-height: 40px; padding: 8px 40px 8px 12px;">
                    <option value="">-- Name ausw√§hlen --</option>
                    <option value="Dr. Thomas M√ºller (Legal)">Dr. Thomas M√ºller (Legal)</option>
                    <option value="Anna Schmidt (Compliance)">Anna Schmidt (Compliance)</option>
                    <option value="Peter Weber (Revision)">Peter Weber (Revision)</option>
                    <option value="Maria Koch (IT)">Maria Koch (IT)</option>
                    <option value="Stefan Braun (Finance)">Stefan Braun (Finance)</option>
                    <option value="Lisa Wagner (HR)">Lisa Wagner (HR)</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          
          <!-- FORMULAR -->
          <form id="caseForm">
            
            <!-- FELD 1: Problem-Titel -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">1</span>
                Problem-Titel
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Kurzer, pr√§gnanter Titel (5-10 W√∂rter)</label>
                <input type="text" class="form-input" id="problemTitel" placeholder="z.B. Manuelle Pr√ºfung von Vertrags√§nderungen zeitaufwendig" maxlength="100" required>
                <span class="form-hint">Beschreiben Sie das Problem in einem Satz.</span>
              </div>
            </div>
            
            <!-- FELD 2: Betroffene Abteilung(en) -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">2</span>
                Betroffene Abteilung(en)
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Welche Abteilungen sind betroffen?</label>
                <div class="form-checkbox-group" id="abteilungen">
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Legal"><span class="form-checkbox-label">Legal</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Compliance"><span class="form-checkbox-label">Compliance</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Revision"><span class="form-checkbox-label">Revision</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="IT"><span class="form-checkbox-label">IT</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="HR"><span class="form-checkbox-label">HR</span></label>
                  <label class="form-checkbox-item"><input type="checkbox" class="form-checkbox" name="abteilung" value="Finance"><span class="form-checkbox-label">Finance</span></label>
                </div>
              </div>
            </div>
            
            <!-- FELD 3: Ausgangslage / Ist-Zustand -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">3</span>
                Ausgangslage / Ist-Zustand
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Wie l√§uft der Prozess aktuell? Was sind die einzelnen Schritte?</label>
                <textarea class="form-textarea" id="ausgangslage" rows="4" placeholder="Beschreiben Sie den aktuellen Ablauf Schritt f√ºr Schritt..." required></textarea>
              </div>
            </div>
            
            <!-- FELD 4: Konkretes Problem / Engpass -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">4</span>
                Konkretes Problem / Engpass
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Was genau ist das Problem? Wo liegt der Flaschenhals?</label>
                <textarea class="form-textarea" id="problem" rows="3" placeholder="z.B. Hoher Zeitaufwand, Fehleranf√§lligkeit, mangelnde Dokumentation..." required></textarea>
              </div>
            </div>
            
            <!-- FELD 5: H√§ufigkeit / Volumen -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">5</span>
                H√§ufigkeit / Volumen
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Wie oft tritt das Problem auf?</label>
                <div class="form-radio-group" id="haeufigkeit">
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="T√§glich"><span class="form-radio-label">T√§glich</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="W√∂chentlich"><span class="form-radio-label">W√∂chentlich</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Monatlich"><span class="form-radio-label">Monatlich</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="haeufigkeit" value="Quartalsweise"><span class="form-radio-label">Quartalsweise</span></label>
                </div>
                <div class="form-inline-group" style="margin-top: var(--spacing-lg);">
                  <span class="form-inline-label">Anzahl Vorg√§nge pro Zeiteinheit:</span>
                  <input type="number" class="form-input form-input-small" id="anzahlVorgaenge" placeholder="z.B. 50" min="1">
                </div>
              </div>
            </div>
            
            <!-- FELD 6: Betroffene Personen & Zeitaufwand -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">6</span>
                Betroffene Personen & Zeitaufwand
              </h3>
              <div class="form-group">
                <div class="grid grid-3" style="gap: var(--spacing-xl);">
                  <div>
                    <label class="form-label form-label-required">Anzahl betroffener Mitarbeiter</label>
                    <input type="number" class="form-input" id="betroffenePersonen" placeholder="z.B. 3" min="1">
                  </div>
                  <div>
                    <label class="form-label form-label-required">Zeitaufwand pro Fall</label>
                    <div class="form-inline-group">
                      <input type="number" class="form-input" id="zeitaufwandWert" placeholder="z.B. 25" min="1" style="width: 100px;">
                      <select class="form-select" id="zeitaufwandEinheit" style="width: auto;">
                        <option value="minutes">Minuten</option>
                        <option value="hours">Stunden</option>
                      </select>
                    </div>
                  </div>
                  <div>
                    <label class="form-label">Gesamtaufwand/Jahr (gesch√§tzt)</label>
                    <input type="text" class="form-input" id="gesamtaufwand" placeholder="Wird berechnet..." readonly style="background: var(--color-bg-light); font-weight: 700; transition: background-color 0.3s ease;">
                    <span class="form-hint" id="gesamtaufwandHint" style="display: none; color: #28a745; margin-top: 4px;">‚úì Automatisch berechnet</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- FELD 7: Strategische Relevanz -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">7</span>
                Strategische Relevanz
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Erste Einsch√§tzung durch Teilnehmer</label>
                <div class="form-radio-group" id="relevanz">
                  <label class="form-radio-item" style="flex: 1; justify-content: center;"><input type="radio" class="form-radio" name="relevanz" value="Hoch"><span class="form-radio-label">‚ñ† Hoch</span></label>
                  <label class="form-radio-item" style="flex: 1; justify-content: center;"><input type="radio" class="form-radio" name="relevanz" value="Mittel"><span class="form-radio-label">‚ñ™ Mittel</span></label>
                  <label class="form-radio-item" style="flex: 1; justify-content: center;"><input type="radio" class="form-radio" name="relevanz" value="Niedrig"><span class="form-radio-label">‚óã Niedrig</span></label>
                </div>
              </div>
            </div>
            
            <!-- FELD 8: Risiko bei Nicht-Handlung -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">8</span>
                Risiko bei Nicht-Handlung
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Was passiert, wenn das Problem NICHT gel√∂st wird? (Skala 1-5)</label>
                <div class="form-rating-group" id="risikoGroup">
                  <label class="form-rating-item"><input type="radio" name="risiko" value="1">1</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="2">2</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="3">3</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="4">4</label>
                  <label class="form-rating-item"><input type="radio" name="risiko" value="5">5</label>
                </div>
                <span class="form-hint" style="margin-top: var(--spacing-sm);">1 = unkritisch | 5 = sehr kritisch</span>
                <div style="margin-top: var(--spacing-lg);">
                  <label class="form-label">Kurze Begr√ºndung (optional)</label>
                  <textarea 
                    class="form-textarea" 
                    id="risikoBegruendung" 
                    rows="3"
                    placeholder="z.B.: Betriebspr√ºfung: Fehler nicht nachzuvollziehen. Compliance-Risiko. Reputationsschaden bei Kunden. Audit-Findings, Bu√ügelder..."
                  ></textarea>
                </div>
              </div>
            </div>
            
            <!-- FELD 9: Vorhandene L√∂sungsans√§tze -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">9</span>
                Vorhandene L√∂sungsans√§tze
              </h3>
              <div class="form-group">
                <label class="form-label">Gibt es bereits Tools, Workarounds oder Teilautomatisierungen?</label>
                <div class="form-radio-group">
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="vorhandeneLoesung" value="yes"><span class="form-radio-label">Ja</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="vorhandeneLoesung" value="no"><span class="form-radio-label">Nein</span></label>
                </div>
                <div style="margin-top: var(--spacing-lg);">
                  <label class="form-label">Falls ja, bitte beschreiben:</label>
                  <input type="text" class="form-input" id="vorhandeneL√∂sungBeschreibung" placeholder="z.B. Excel-Makro, SharePoint-Workflow...">
                </div>
              </div>
            </div>
            
            <!-- FELD 10: Daten-Verf√ºgbarkeit -->
            <div class="form-section">
              <h3 class="form-section-title">
                <span class="form-section-number">10</span>
                Daten-Verf√ºgbarkeit
              </h3>
              <div class="form-group">
                <label class="form-label form-label-required">Liegen die relevanten Daten digital vor?</label>
                <div class="form-radio-group" id="datenVerfuegbarkeit">
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="full_digital"><span class="form-radio-label">‚úÖ Ja, vollst√§ndig digital</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="partial"><span class="form-radio-label">‚ö†Ô∏è Teilweise digital</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="paper"><span class="form-radio-label">üìÑ √úberwiegend Papier</span></label>
                  <label class="form-radio-item"><input type="radio" class="form-radio" name="datenVerfuegbarkeit" value="unclear"><span class="form-radio-label">‚ùì Unklar</span></label>
                </div>
              </div>
            </div>
            
            <!-- FELD 11: KI-Potenzial -->
            <div class="form-section" style="background: var(--color-bg-light);">
              <h3 class="form-section-title">
                <span class="form-section-number">11</span>
                KI-Potenzial (Optional)
              </h3>
              <div class="form-group">
                <label class="form-label">
                  Wo k√∂nnte KI theoretisch unterst√ºtzen?
                </label>
                <textarea 
                  class="form-textarea" 
                  id="kiPotenzial" 
                  rows="5"
                  placeholder="z.B. KI k√∂nnte automatisch:
‚Ä¢ Belege-Vollst√§ndigkeit pr√ºfen
‚Ä¢ Kostens√§tze abgleichen
‚Ä¢ Richtlinien-Regeln pr√ºfen
‚Ä¢ Abweichungen flaggen
‚Ä¢ Textanalyse durchf√ºhren
‚Ä¢ Kategorisierung vornehmen

Tippe hier - das Feld w√§chst automatisch mit!"
                  style="background: var(--color-bg-white); min-height: 150px;"
                ></textarea>
                <span class="form-hint">‚ÑπÔ∏è Keine Bewertung erforderlich. Dient nur der sp√§teren Analyse. Das Feld w√§chst automatisch beim Tippen!</span>
              </div>
            </div>
            
            <!-- DISCLAIMER BOX -->
            <div class="form-disclaimer">
              <div class="form-disclaimer-icon">‚ÑπÔ∏è</div>
              <div class="form-disclaimer-title">WICHTIG ZU VERSTEHEN:</div>
              <ul class="form-disclaimer-list">
                <li>Dieses Formular dient NUR der strukturierten Erfassung.</li>
                <li>KEINE KI-Bewertung w√§hrend des Workshops!</li>
                <li>Alle Eingaben werden f√ºr alle Teilnehmer sichtbar auf dem Beamer angezeigt.</li>
                <li>Die erfassten Metriken erm√∂glichen sp√§ter eine KI-gest√ºtzte Priorisierung.</li>
              </ul>
            </div>
            
            <!-- FORM ACTIONS -->
            <div class="form-actions">
              <div class="form-actions-left">
                <button type="button" class="btn btn-secondary" onclick="goToPreviousCase()">‚Üê Vorheriger Case</button>
                <button type="button" class="btn btn-tertiary" onclick="clearForm()">üóëÔ∏è Formular leeren</button>
              </div>
              <div class="form-actions-right">
                <button type="button" class="btn btn-secondary" onclick="saveAndStay()">üíæ Zwischenspeichern</button>
                <button type="button" class="btn btn-primary btn-lg" onclick="saveAndNext()">Speichern & N√§chster Case ‚Üí</button>
              </div>
            </div>
            
          </form>
          
        </div><!-- /form-container -->
        
        <!-- SUCCESS MODAL -->
        <div id="successModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); z-index: 1000; align-items: center; justify-content: center;">
          <div style="background: var(--white); padding: var(--space-10); border-radius: var(--border-radius-xl); text-align: center; max-width: 400px; border: 1px solid var(--border-gray); box-shadow: var(--shadow-lg);">
            <div style="font-size: 48px; margin-bottom: var(--space-4);">‚úÖ</div>
            <h2 style="margin-bottom: var(--space-2); color: var(--text-darkest);" id="modalTitle">Case #01 gespeichert!</h2>
            <p style="color: var(--text-medium); margin-bottom: var(--space-6);" id="modalText">Das Formular wurde geleert. Bereit f√ºr den n√§chsten Case.</p>
            <button class="btn btn-primary" onclick="closeModal()">Weiter</button>
          </div>
        </div>
        
      </div><!-- /container -->
      
    </main>
    
    <!-- FOOTER -->
    <footer class="footer">
      <div class="footer-inner">
        <span>¬© 2026 gannaca AI-Case Sprint Framework</span>
        <span>Konzeptioneller Mockup ‚Äì Keine Produktivdaten</span>
      </div>
    </footer>
    
  </div><!-- /page-wrapper -->
  
  <!-- ============================================
       JAVASCRIPT
       ============================================ -->
  <script>
    // Beim Laden der Seite
    document.addEventListener('DOMContentLoaded', function() {
      updateUI();
      updateTime();
      
      // Markiere aktuellen Tab als "active"
      const currentPage = window.location.pathname.split('/').pop();
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.getAttribute('href') === currentPage) {
          tab.classList.add('active');
        }
      });
      setInterval(updateTime, 60000); // Zeit jede Minute aktualisieren
      
      // Rating Items klickbar machen
      document.querySelectorAll('.form-rating-item').forEach(item => {
        item.addEventListener('click', function() {
          this.parentElement.querySelectorAll('.form-rating-item').forEach(i => i.classList.remove('selected'));
          this.classList.add('selected');
          this.querySelector('input').checked = true;
        });
      });
      
      // Checkbox/Radio Styling
      document.querySelectorAll('.form-checkbox, .form-radio').forEach(input => {
        input.addEventListener('change', function() {
          if (this.type === 'checkbox') {
            this.closest('.form-checkbox-item').classList.toggle('selected', this.checked);
          } else {
            document.querySelectorAll(`input[name="${this.name}"]`).forEach(r => {
              r.closest('.form-radio-item').classList.remove('selected');
            });
            this.closest('.form-radio-item').classList.add('selected');
          }
        });
      });
      
      // ============================================
      // GESAMTAUFWAND AUTO-BERECHNUNG (Schritt 5 + 6)
      // ============================================
      // Event-Listener f√ºr H√§ufigkeit (Radio-Buttons)
      document.querySelectorAll('input[name="haeufigkeit"]').forEach(radio => {
        radio.addEventListener('change', calculateYearlyEffort);
      });
      
      // Event-Listener f√ºr numerische Eingaben
      ['anzahlVorgaenge', 'zeitaufwandWert'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('input', calculateYearlyEffort);
          el.addEventListener('change', calculateYearlyEffort);
        }
      });
      
      // Event-Listener f√ºr Zeiteinheit
      const zeitEinheit = document.getElementById('zeitaufwandEinheit');
      if (zeitEinheit) {
        zeitEinheit.addEventListener('change', calculateYearlyEffort);
      }
      
      // ============================================
      // AUTO-EXPAND TEXTAREAS
      // Textareas wachsen automatisch mit dem Inhalt!
      // ============================================
      initAutoExpandTextareas();
      
      // ============================================
      // SMOOTH SCROLL-TO-FIELD
      // Scrollt smooth zum Feld beim Fokus
      // ============================================
      setupSmoothScrollToField();
    });
    
    // ============================================
    // SMOOTH SCROLL-TO-FIELD FUNKTION
    // Zentriert das fokussierte Feld im Viewport
    // ============================================
    function setupSmoothScrollToField() {
      const formFields = document.querySelectorAll(
        'input[type="text"], input[type="number"], textarea, select'
      );
      
      formFields.forEach(field => {
        field.addEventListener('focus', function() {
          // Kurze Verz√∂gerung f√ºr bessere UX
          setTimeout(() => {
            scrollToFieldSmooth(this);
          }, 150);
        });
      });
    }
    
    function scrollToFieldSmooth(field) {
      // Berechne Sticky-Header Offset
      const browserChrome = 48; // Browser-Chrome H√∂he
      const header = document.querySelector('.header');
      const banner = document.querySelector('.data-protection-banner');
      const tabs = document.querySelector('.nav-tabs');
      
      let offset = browserChrome + 40; // Base + Extra Padding
      if (header) offset += header.offsetHeight;
      if (banner) offset += banner.offsetHeight;
      if (tabs) offset += tabs.offsetHeight;
      
      // Berechne Position des Feldes
      const rect = field.getBoundingClientRect();
      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const targetY = rect.top + scrollTop - offset;
      
      // Smooth Scroll
      window.scrollTo({
        top: targetY,
        behavior: 'smooth'
      });
    }
    
    // ============================================
    // AUTO-EXPAND TEXTAREA FUNKTION
    // Keine scrollbaren Textareas - sie wachsen mit!
    // ============================================
    function autoExpandTextarea(textarea) {
      // H√∂he zur√ºcksetzen, um echte Inhaltsh√∂he zu messen
      textarea.style.height = 'auto';
      
      // Neue H√∂he basierend auf scrollHeight (= echter Inhalt)
      const newHeight = Math.max(textarea.scrollHeight, 120); // Mindestens 120px
      textarea.style.height = newHeight + 'px';
    }
    
    function initAutoExpandTextareas() {
      // Alle Textareas auf der Seite finden
      document.querySelectorAll('textarea').forEach(textarea => {
        // Initiale Mindesth√∂he
        textarea.style.minHeight = '120px';
        
        // Event-Listener f√ºr Auto-Expand bei Eingabe
        textarea.addEventListener('input', function() {
          autoExpandTextarea(this);
        });
        
        // Event-Listener f√ºr Paste (eingef√ºgter Text)
        textarea.addEventListener('paste', function() {
          // Kurze Verz√∂gerung, damit der Text erst eingef√ºgt wird
          setTimeout(() => autoExpandTextarea(this), 10);
        });
        
        // Initiale Berechnung falls bereits Inhalt vorhanden
        if (textarea.value) {
          autoExpandTextarea(textarea);
        }
        
        // Bullet-Point-Funktion aktivieren
        enableBulletPoints(textarea);
      });
    }
    
    // ============================================
    // BULLET-POINT AUTO-FORMATTING
    // Bei Enter ‚Üí automatisch "- " auf neuer Zeile
    // ============================================
    function enableBulletPoints(textarea) {
      textarea.addEventListener('keydown', function(event) {
        // Nur bei Enter-Taste
        if (event.key === 'Enter') {
          const start = this.selectionStart;
          const end = this.selectionEnd;
          const text = this.value;
          
          // Finde Anfang der aktuellen Zeile
          let lineStart = text.lastIndexOf('\n', start - 1) + 1;
          let currentLine = text.substring(lineStart, start);
          
          // Pr√ºfe, ob aktuelle Zeile mit Bullet-Point beginnt (- oder ‚Ä¢)
          const bulletMatch = currentLine.match(/^(\s*)([-‚Ä¢])\s/);
          
          if (bulletMatch) {
            // Aktuelle Zeile hat Bullet-Point
            const indentation = bulletMatch[1];
            const bulletChar = bulletMatch[2];
            
            // Pr√ºfe, ob Zeile NUR aus Bullet-Point besteht (leer)
            if (currentLine.trim() === '-' || currentLine.trim() === '‚Ä¢') {
              // Leere Bullet-Zeile ‚Üí Bullet entfernen, aus Liste aussteigen
              event.preventDefault();
              this.value = text.substring(0, lineStart) + text.substring(start);
              this.selectionStart = this.selectionEnd = lineStart;
            } else {
              // Normale Bullet-Zeile ‚Üí neue Zeile mit Bullet
              event.preventDefault();
              const newText = '\n' + indentation + bulletChar + ' ';
              this.value = text.substring(0, start) + newText + text.substring(end);
              this.selectionStart = this.selectionEnd = start + newText.length;
            }
          } else if (currentLine.trim() !== '') {
            // Erste Zeile mit Inhalt, aber kein Bullet ‚Üí Bullet hinzuf√ºgen
            event.preventDefault();
            this.value = text.substring(0, start) + '\n- ' + text.substring(end);
            this.selectionStart = this.selectionEnd = start + 3;
          }
          // Sonst: Normale Enter-Taste (Standard-Verhalten)
          
          // Auto-Expand ausl√∂sen
          autoExpandTextarea(this);
        }
      });
    }
    
    // ============================================
    // GESAMTAUFWAND BERECHNUNG
    // Formel: (H√§ufigkeit √ó Anzahl pro Zeiteinheit) √ó Zeitaufwand pro Fall
    // ============================================
    function calculateYearlyEffort() {
      const gesamtaufwandField = document.getElementById('gesamtaufwand');
      const hintField = document.getElementById('gesamtaufwandHint');
      
      // H√§ufigkeit auslesen
      const haeufigkeitRadio = document.querySelector('input[name="haeufigkeit"]:checked');
      const haeufigkeit = haeufigkeitRadio ? haeufigkeitRadio.value : '';
      
      // Anzahl Vorg√§nge auslesen
      const anzahl = parseFloat(document.getElementById('anzahlVorgaenge').value) || 0;
      
      // Zeitaufwand auslesen
      const zeitWert = parseFloat(document.getElementById('zeitaufwandWert').value) || 0;
      const zeitEinheit = document.getElementById('zeitaufwandEinheit').value; // 'minutes' oder 'hours'
      
      // Pr√ºfen ob genug Daten vorhanden
      if (!haeufigkeit || anzahl <= 0 || zeitWert <= 0) {
        gesamtaufwandField.value = '';
        gesamtaufwandField.placeholder = 'Wird berechnet...';
        gesamtaufwandField.style.backgroundColor = 'var(--color-bg-light)';
        hintField.style.display = 'none';
        return;
      }
      
      // Visuelles Feedback: Gelb w√§hrend Berechnung
      gesamtaufwandField.style.backgroundColor = '#FFF3CD';
      
      // Multiplikator basierend auf H√§ufigkeit (auf Jahresbasis)
      let multiplier = 1;
      switch(haeufigkeit) {
        case 'T√§glich':
          multiplier = 365;
          break;
        case 'W√∂chentlich':
          multiplier = 52;
          break;
        case 'Monatlich':
          multiplier = 12;
          break;
        case 'Quartalsweise':
          multiplier = 4;
          break;
      }
      
      // Berechnung: Anzahl √ó Zeitaufwand √ó Multiplikator
      let totalMinutesPerYear = anzahl * zeitWert * multiplier;
      
      // Falls Eingabe in Stunden, in Minuten umrechnen f√ºr einheitliche Basis
      if (zeitEinheit === 'hours') {
        totalMinutesPerYear = totalMinutesPerYear * 60;
      }
      
      // In Stunden umrechnen f√ºr Anzeige
      const totalHoursPerYear = totalMinutesPerYear / 60;
      
      // Nach 500ms: Visuelles Feedback zeigen
      setTimeout(() => {
        // Ergebnis formatieren und anzeigen
        if (totalHoursPerYear >= 1) {
          gesamtaufwandField.value = totalHoursPerYear.toLocaleString('de-DE', {maximumFractionDigits: 0}) + ' Stunden/Jahr';
        } else {
          gesamtaufwandField.value = totalMinutesPerYear.toLocaleString('de-DE', {maximumFractionDigits: 0}) + ' Minuten/Jahr';
        }
        
        // Gr√ºner Hintergrund = Berechnung fertig
        gesamtaufwandField.style.backgroundColor = '#D4EDDA';
        
        // Hinweis anzeigen
        hintField.style.display = 'block';
      }, 300);
    }
    
    // UI aktualisieren
    function updateUI() {
      const cases = getAllCases();
      const nextNumber = cases.length + 1;
      
      // Case-Nummer
      document.getElementById('caseNumber').textContent = '#' + nextNumber.toString().padStart(2, '0');
      
      // Fortschritt
      document.getElementById('progressCount').textContent = `${cases.length} von ~20 (Ziel)`;
      document.getElementById('progressFill').style.width = `${(cases.length / 20) * 100}%`;
    }
    
    // Zeit aktualisieren
    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent = now.toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'}) + ' Uhr';
    }
    
    // Formular-Daten sammeln
    function collectFormData() {
      const data = {
        teilnehmer: document.getElementById('teilnehmer').value,
        problemTitel: document.getElementById('problemTitel').value,
        abteilungen: Array.from(document.querySelectorAll('input[name="abteilung"]:checked')).map(cb => cb.value),
        ausgangslage: document.getElementById('ausgangslage').value,
        problem: document.getElementById('problem').value,
        haeufigkeit: document.querySelector('input[name="haeufigkeit"]:checked')?.value || '',
        anzahlVorgaenge: document.getElementById('anzahlVorgaenge').value,
        betroffenePersonen: document.getElementById('betroffenePersonen').value,
        zeitaufwandWert: document.getElementById('zeitaufwandWert').value,
        zeitaufwandEinheit: document.getElementById('zeitaufwandEinheit').value,
        gesamtaufwandJahr: document.getElementById('gesamtaufwand').value, // Berechneter Wert
        strategischeRelevanz: document.querySelector('input[name="relevanz"]:checked')?.value || '',
        risiko: document.querySelector('input[name="risiko"]:checked')?.value || '',
        risikoBegruendung: document.getElementById('risikoBegruendung').value,
        vorhandeneLoesung: document.querySelector('input[name="vorhandeneLoesung"]:checked')?.value || '',
        vorhandeneL√∂sungBeschreibung: document.getElementById('vorhandeneL√∂sungBeschreibung').value,
        datenVerfuegbarkeit: document.querySelector('input[name="datenVerfuegbarkeit"]:checked')?.value || '',
        kiPotenzial: document.getElementById('kiPotenzial').value
      };
      return data;
    }
    
    // Validierung
    function validateForm() {
      const titel = document.getElementById('problemTitel').value.trim();
      const ausgangslage = document.getElementById('ausgangslage').value.trim();
      const problem = document.getElementById('problem').value.trim();
      
      if (!titel) {
        alert('‚ö†Ô∏è Bitte geben Sie einen Problem-Titel ein.');
        document.getElementById('problemTitel').focus();
        return false;
      }
      if (!ausgangslage) {
        alert('‚ö†Ô∏è Bitte beschreiben Sie die Ausgangslage.');
        document.getElementById('ausgangslage').focus();
        return false;
      }
      if (!problem) {
        alert('‚ö†Ô∏è Bitte beschreiben Sie das konkrete Problem.');
        document.getElementById('problem').focus();
        return false;
      }
      return true;
    }
    
    // Speichern und weiter
    function saveAndNext() {
      if (!validateForm()) return;
      
      const data = collectFormData();
      const caseNum = saveCase(data);
      
      // Modal zeigen
      document.getElementById('modalTitle').textContent = `Case #${(caseNum).toString().padStart(2, '0')} gespeichert!`;
      document.getElementById('successModal').style.display = 'flex';
      
      // Formular leeren
      clearForm();
      updateUI();
    }
    
    // Speichern und bleiben
    function saveAndStay() {
      if (!validateForm()) return;
      
      const data = collectFormData();
      const caseNum = saveCase(data);
      
      alert(`‚úÖ Case #${caseNum.toString().padStart(2, '0')} gespeichert!\n\nSie k√∂nnen nun √Ñnderungen vornehmen oder zur Ergebnis-√úbersicht wechseln.`);
      updateUI();
    }
    
    // Formular leeren
    function clearForm() {
      document.getElementById('caseForm').reset();
      document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
      
      // Gesamtaufwand-Feld zur√ºcksetzen
      const gesamtaufwandField = document.getElementById('gesamtaufwand');
      const hintField = document.getElementById('gesamtaufwandHint');
      gesamtaufwandField.value = '';
      gesamtaufwandField.placeholder = 'Wird berechnet...';
      gesamtaufwandField.style.backgroundColor = 'var(--color-bg-light)';
      hintField.style.display = 'none';
      
      window.scrollTo(0, 0);
      updateUI();
    }
    
    // Zum vorherigen Case
    function goToPreviousCase() {
      const cases = getAllCases();
      if (cases.length === 0) {
        alert('Es gibt noch keine gespeicherten Cases.');
        return;
      }
      
      // Zur Ergebnis-Seite wechseln
      window.location.href = 'screen-7-results.html';
    }
    
    // Modal schlie√üen
    function closeModal() {
      document.getElementById('successModal').style.display = 'none';
    }
  </script>
  
</body>
</html>
